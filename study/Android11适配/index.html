

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Android11适配 - Android高级工程师</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="安卓更新换代非常快，5.0之前版本更新的时间线有点看不...">
  <meta name="author" content="MengLong Sun">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: false,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: false,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: true,
        path: 'search.xml'
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
      
      
        <i class="iconfont iconsearch j-navbar-search"></i>
      
    </div>
    <div class="center">Android11适配</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 相册</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a><p><a target="_blank" href="https://beian.miit.gov.cn/">京ICP备20023327号-1</a></p></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/../../images/cover/cover_3.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">Android11适配</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>December 09, 2021</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>9035</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <p>安卓更新换代非常快，5.0之前版本更新的时间线有点看不懂，但5.0之后更新还是比较稳定的，大概一年更新一次，谷歌工程师对安卓每个版本的命名也有点意思，比如棒棒糖、棉花糖、奥利奥、馅饼啊啥的（命名的应该也是个吃货），还有，从1.5开始，之后的版本都按照英文字母顺序排列，从C开始，到现在的11排到了R。</p>
<p>2019年5月8日，谷歌在Google I/O 2019开发者大会上，正式公布了安卓10系统。经过数月的Beta版测试，谷歌又于2019年9月4日，推送了安卓10正式版。</p>
<p>从谷歌推出安卓10到现在也快一年的时间了，好多应用还没有适配，但现在安卓11的开发者预览版已经出来了，本来应该在今年的I/O大会上发布正式版安卓11的，但是由于疫情影响，3月21日发布消息，受新冠肺炎疫情影响，谷歌周五宣布彻底取消一年一度的I/O开发者大会，此前该公司在3月3日宣布，由于受到新冠病毒疫情的影响，将把I/O大会改为仅在线上举行，但现在线上大会也被取消了。</p>
<p>虽然今年I/O大会不开了，但是安卓11肯定要发布的，所以开发人员也别想跑，也需要适配啊！</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>“大哥，你这说了半天安卓11的适配在哪呢？”</p>
<p>“别着急啊，下面不是就要说了嘛！”</p>
<p>“快说，再白活会就取关了！”</p>
<p>“这就来这就来，哎！如果你有Pixel，那么恭喜你可以直接通过刷OTA的方式来体验和提前适配安卓11。“</p>
<p>”没有？跟我一样来使用模拟器吧！“</p>
<p>“什么？不知道怎么配置？真的是，给你说下吧，记好了。”</p>
<ol>
<li><p>在 Android Studio 中，依次点击 <strong>Tools &gt; SDK Manager</strong>。</p>
</li>
<li><p>在 <strong>SDK Platforms</strong> 标签页下，选择窗口底部的 <strong>Show Package Details</strong>。</p>
</li>
<li><p>在 <strong>Android 11 Developer Preview</strong> 下，选择系统映像（例如 <strong>Google APIs Intel x86 Atom System Image</strong>）。</p>
</li>
<li><p>在 <strong>SDK Tools</strong> 标签页中，选择最新版 <strong>Android 模拟器</strong>，点击 <strong>OK</strong> 开始安装。</p>
</li>
<li><p>安装完成后，依次选择 <strong>Tools &gt; AVD Manager</strong>，然后按照说明创建新的 AVD。</p>
<p>请务必选择 Pixel 设备，并对系统映像选择 <strong>R</strong>。</p>
</li>
<li><p>返回 AVD 管理器的虚拟设备列表，双击新虚拟设备即可启动该设备。</p>
</li>
</ol>
<p>“万事俱备，只欠适配了！”</p>
<p>这里就不写刷OTA的具体步骤了，需要的可以自行下载和刷写。</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/preview/download#flash">https://developer.android.google.cn/preview/download#flash</a></p>
<h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>“来了来了，开始了，别说话了，安静！！！”</p>
<h3 id="分区存储"><a href="#分区存储" class="headerlink" title="分区存储"></a><strong>分区存储</strong></h3><p>还记得在适配安卓10的时候设置requestLegacyExternalStorage为true来修改外部存储空间视图模型（true为 Legacy View，false 为 Filtered View）吗？这是重点：<strong>当您将应用更新为以 Android 11 为目标平台后，将无法使用</strong> <strong><code>requestLegacyExternalStorage</code> 来停用分区存储。</strong></p>
<p>“大哥，这都停用了那我该怎么适配呢？”</p>
<p>“这孩子，猴急猴急的，这不就要说了嘛！”</p>
<h4 id="数据迁移到使用分区存储时可见的目录："><a href="#数据迁移到使用分区存储时可见的目录：" class="headerlink" title="数据迁移到使用分区存储时可见的目录："></a>数据迁移到使用分区存储时可见的目录：</h4><p>在以 Android 11 为目标平台之前，应将数据迁移到与分区存储兼容的目录。在大多数情况下，可以将数据迁移到应用的应用专用目录。</p>
<p>如果有要迁移的数据，当用户升级到以 Android 11 为目标平台的新版应用时，可以保留旧版存储模型。这样，用户就可以保留对应用之前用来保存数据的目录中存储的应用数据的访问权限。要启用旧版存储模型以进行升级，请在应用的清单中将 <code>requestLegacyExternalStorage</code> 属性设为 <code>true</code>。</p>
<p>这里需要注意以下两点：</p>
<ul>
<li>大多数应用都不需要使用 <code>preserveLegacyExternalStorage</code>。此标记仅适用于这样一种情况：你将应用数据迁移到了与分区存储兼容的位置，并且希望用户在更新你应用时保留对数据的访问权限。使用此标记会导致更难以测试分区存储对应用的用户有何影响，因为当用户更新应用时，它会继续使用旧版存储模型。</li>
<li>如果使用 <code>preserveLegacyExternalStorage </code>，则旧版存储模型只在用户卸载应用之前保持有效。如果用户在搭载 Android 11 的设备上安装或重新安装应用，则无论 <code>preserveLegacyExternalStorage</code>的值是什么，应用都无法停用分区存储模型。</li>
</ul>
<h4 id="测试分区存储"><a href="#测试分区存储" class="headerlink" title="测试分区存储"></a>测试分区存储</h4><p>如果要在应用中启用分区存储，而不考虑应用的目标 SDK 版本和清单标记值，请启用以下应用兼容性标记：</p>
<ul>
<li><code>DEFAULT_SCOPED_STORAGE</code>（默认情况下，对所有应用处于启用状态）</li>
<li><code>FORCE_ENABLE_SCOPED_STORAGE</code>（默认情况下，对所有应用处于停用状态）</li>
</ul>
<p>要<strong>停用</strong>分区存储而改用旧版存储模型，请<strong>取消设置</strong>这两个标记。</p>
<h3 id="管理设备存储空间"><a href="#管理设备存储空间" class="headerlink" title="管理设备存储空间"></a><strong>管理设备存储空间</strong></h3><p>如果你的应用是文件管理器应用并且在 Android 11 上运行，它就不能再删除其他应用的缓存文件，即使您的应用具有所有文件访问权限也是如此（清理文件的应用尤其需要注意，比如某某<strong>管家、卫士</strong>啥的）。相反，你应执行以下操作：</p>
<ol>
<li>通过调用 <code>ACTION_MANAGE_STORAGE</code> intent 操作来检查可用空间。</li>
<li>如果设备上的可用空间不足，请提示用户同意让您的应用清除所有缓存。为此，请调用 <code>ACTION_CLEAR_APP_CACHE</code> intent 操作。</li>
</ol>
<p>这里需要注意：<code>ACTION_CLEAR_APP_CACHE</code> intent 操作会<strong>严重影响设备的电池续航时间</strong>，并且可能会从设备上<strong>移除大量的文件</strong>。</p>
<h3 id="媒体文件访问权限"><a href="#媒体文件访问权限" class="headerlink" title="媒体文件访问权限"></a><strong>媒体文件访问权限</strong></h3><p>这个很赞，Android 11 增加了以下访问媒体功能。</p>
<h4 id="执行批量操作"><a href="#执行批量操作" class="headerlink" title="执行批量操作"></a>执行批量操作</h4><p>为实现各种设备之间的一致性并增加用户便利性，Android 11 向 <code>MediaStore</code> API 中添加了多种方法。对于希望简化特定媒体文件更改流程（例如在原位置编辑照片）的应用而言，这些方法尤为有用。</p>
<ul>
<li><p>[<code>createWriteRequest()</code>]<br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/provider/MediaStore#createDeleteRequest">https://developer.android.google.cn/reference/android/provider/MediaStore#createDeleteRequest</a><br>(android.content.ContentResolver, java.util.Collection))</p>
<p>用户向应用授予对指定媒体文件组的写入访问权限的请求。</p>
</li>
<li><p>[<code>createFavoriteRequest()</code>]<br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/provider/MediaStore#createFavoriteRequest">https://developer.android.google.cn/reference/android/provider/MediaStore#createFavoriteRequest</a><br>(android.content.ContentResolver, java.util.Collection, boolean))</p>
<p>用户将设备上指定的媒体文件标记为“收藏”的请求。对该文件具有读取访问权限的任何应用都可以看到用户已将该文件标记为“收藏”。</p>
</li>
<li><p>[<code>createTrashRequest()</code>]<br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/provider/MediaStore#createTrashRequest">https://developer.android.google.cn/reference/android/provider/MediaStore#createTrashRequest</a><br>(android.content.ContentResolver, java.util.Collection, boolean))</p>
<p>用户将指定的媒体文件放入设备垃圾箱的请求。垃圾箱中的内容在特定时间段（默认为 7 天）后会永久删除。</p>
</li>
<li><p>[<code>createDeleteRequest()</code>]<br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/provider/MediaStore#createWriteRequest">https://developer.android.google.cn/reference/android/provider/MediaStore#createWriteRequest</a><br>(android.content.ContentResolver, java.util.Collection))<br>用户立即永久删除指定的媒体文件（而不是先将其放入垃圾箱）的请求。</p>
</li>
</ul>
<p>系统在调用以上任何一个方法后，会构建一个 <code>PendingIntent</code> 对象。应用调用此 intent 后，用户会看到一个对话框，请求用户同意应用更新或删除指定的媒体文件。</p>
<h4 id="使用原始路径访问文件"><a href="#使用原始路径访问文件" class="headerlink" title="使用原始路径访问文件"></a>使用原始路径访问文件</h4><p>从 Android 11 开始，具有 <code>READ_EXTERNAL_STORAGE</code> 权限的应用可以使用直接文件路径和原生库来读取设备的媒体文件。通过这项新功能，应用可以更顺畅地使用第三方媒体库。</p>
<h3 id="文件和目录访问限制"><a href="#文件和目录访问限制" class="headerlink" title="文件和目录访问限制"></a><strong>文件和目录访问限制</strong></h3><p>以下与存储访问框架 (SAF) 相关的变更只有在应用以 Android 11 为目标平台时才会生效。</p>
<h4 id="访问目录"><a href="#访问目录" class="headerlink" title="访问目录"></a>访问目录</h4><p>无法再使用 <code>ACTION_OPEN_DOCUMENT_TREE</code> intent 操作来请求访问以下目录：</p>
<ul>
<li><code>Downloads</code> 根目录。</li>
<li>设备制造商认为可靠的各个 SD 卡卷的根目录，无论该卡是模拟卡还是可移除的卡。</li>
</ul>
<h4 id="访问文件"><a href="#访问文件" class="headerlink" title="访问文件"></a>访问文件</h4><p>无法再使用 <code>ACTION_OPEN_DOCUMENT_TREE</code> 或 <code>ACTION_OPEN_DOCUMENT</code> intent 操作来请求用户从以下目录中选择单独的文件：</p>
<ul>
<li><p>Android/data/目录及其所有子目录。</p>
</li>
<li><p><code>Android/obb/</code> 目录及其所有子目录。</p>
</li>
</ul>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a><strong>权限</strong></h3><p>不管应用的目标 SDK 版本是什么，以下变更均会在 Android 11 中生效：</p>
<ul>
<li><strong>存储</strong>运行时权限已重命名为<strong>文件和媒体</strong>。</li>
<li>如果应用未停用分区存储并且请求 <code>READ_EXTERNAL_STORAGE</code> 权限，则用户会看到不同于 Android 10 的对话框。该对话框会指示应用正在请求访问照片、视频、音频剪辑和文件。</li>
<li>用户可以在系统设置中查看哪些应用具有 <code>READ_EXTERNAL_STORAGE</code> 权限。在<strong>设置 &gt; 隐私 &gt; 权限管理器 &gt; 文件和媒体</strong>页面上，具有该权限的每个应用都列在<strong>允许存储所有文件</strong>下。</li>
</ul>
<p>这里要注意：如果应用以 Android 11 为目标平台，切记，对“所有文件”的这种访问权限是只读访问权限。要使用此应用读取<strong>和写入</strong>共享的存储空间中的所有文件，需要具有所有文件访问权限。</p>
<h3 id="所有文件访问权限"><a href="#所有文件访问权限" class="headerlink" title="所有文件访问权限"></a><strong>所有文件访问权限</strong></h3><p>某些应用的核心用例需要访问大量的文件，如文件管理操作或备份和恢复操作。这些应用可通过执行以下操作来获取“所有文件访问权限”：</p>
<ol>
<li>声明 <code>MANAGE_EXTERNAL_STORAGE</code> 权限。</li>
<li>使用 <code>ACTION_MANAGE_ALL_FILES_ACCESS_PERMISSION</code> intent 操作将用户引导至一个系统设置页面，在该页面上，用户可以为应用启用以下选项：<strong>授予所有文件的管理权限</strong>。</li>
</ol>
<p>“所有文件访问权限”可授予以下权限：</p>
<ul>
<li>对共享的存储空间内所有文件的读写访问权限。</li>
<li>对 <code>MediaStore.Files</code> 表的内容的访问权限。</li>
</ul>
<p>应用可以使用 <code>MediaStore</code> API 或原始文件路径来访问这些文件。如果应用使用存储访问框架，不能使用它来访问“所有文件访问权限”提供的其他文件和目录。获得此权限的应用仍然无法访问属于其他应用的应用专用目录。这些目录在存储卷上显示为 <code>Android/data/</code> 的子目录。</p>
<h3 id="自定义消息框视图被屏蔽"><a href="#自定义消息框视图被屏蔽" class="headerlink" title="自定义消息框视图被屏蔽"></a><strong>自定义消息框视图被屏蔽</strong></h3><p>出于安全方面的考虑，同时也为了保持良好的用户体验，如果包含自定义视图的消息框是以 Android 11 为目标平台的应用从后台发送的，则系统会屏蔽这些消息框。请注意，仍允许使用文本消息框；此类消息框是使用 <code>Toast.makeText()</code> 创建的，并不调用 <code>setView()</code>。</p>
<p>如果您的应用仍尝试从后台发布包含自定义视图的消息框，则系统不会向用户显示相应的消息，而会执行以下操作：</p>
<ol>
<li><p>显示以下消息框消息：</p>
<p><code>Background custom toast blocked for package package-name. See g.co/dev/toast.</code></p>
</li>
<li><p>在 logcat 中记录以下消息：</p>
<p><code>W/NotificationService: Blocking custom toast from package due to package not in the foreground</code></p>
</li>
</ol>
<p>如果希望在消息框（文本消息框或自定义消息框）出现或消失时收到通知，请使用新的 <code>addCallback()</code> 方法。</p>
<p>这里需要注意，由于平台行为发生了变更，以 Android 11 为目标平台的应用会发现文本消息框受到以下负面影响：</p>
<ul>
<li><code>getView()</code> 方法返回 <code>null</code>。</li>
<li>以下方法的返回值并不反映实际值，因此尽量别使用：</li>
<li><ul>
<li><code>getHorizontalMargin()</code></li>
<li><code>getVerticalMargin()</code></li>
<li><code>getGravity()</code></li>
<li><code>getXOffset()</code></li>
<li><code>getYOffset()</code></li>
</ul>
</li>
<li>以下方法是空操作，因此应用不应使用：</li>
<li><ul>
<li>[<code>setMargin()</code>](developer.android.google.cn/reference/a…(float, float))</li>
<li>[<code>setGravity()</code>](developer.android.google.cn/reference/a…(int, int, int))</li>
</ul>
</li>
</ul>
<h3 id="前台服务类型"><a href="#前台服务类型" class="headerlink" title="** 前台服务类型**"></a>** 前台服务类型**</h3><p>从 Android 9 开始，应用仅限于在前台访问摄像头和麦克风。为了进一步保护用户，Android 11 更改了前台服务访问摄像头和麦克风相关数据的方式。如果应用以 Android 11 为目标平台并且在某项前台服务中访问这些类型的数据，则需要在该前台服务的声明的 <code>foregroundServiceType</code> 属性中添加新的 <code>camera</code> 和 <code>microphone</code> 类型。</p>
<p>来举个例子吧，如果应用中的某项前台服务需要访问与设备的位置信息和摄像头相关的数据，请按以下代码段所示声明该服务：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;manifest&gt;<br>        ...<br>        &lt;service ... android:foregroundServiceType=<span class="hljs-string">&quot;location|camera&quot;</span> /&gt;<br>&lt;/manifest&gt;<br></code></pre></td></tr></table></figure>

<h3 id="MAC-地址"><a href="#MAC-地址" class="headerlink" title="MAC 地址"></a><strong>MAC 地址</strong></h3><p>在以 Android 10（API 级别 29）及更低版本为目标平台的应用中，MAC 地址的随机分配是基于每个 SSID 进行的，因为 Passpoint 可以连接到同一资料的不同 SSID。而在以 Android 11（API 级别“R”）及更高版本为目标平台的应用中，Passpoint 网络的 MAC 地址随机分配将更改为针对每个完全限定域名 (FQDN) 进行分配。</p>
<p>对于以 API 级别“R”及更高级别为目标平台的应用，非特权应用将无法访问设备的 MAC 地址；只有具有 IPv4 地址的网络接口可见。会影响 <code>getifaddrs()</code> 和 <code>NetworkInterface.getHardwareAddress()</code> 方法，以及 <code>RTM_GETLINK</code> netlink 消息的发送。</p>
<p>下面列出了此变更会以哪些方式来影响应用：</p>
<ul>
<li><code>NetworkInterface.getHardwareAddress()</code> 会针对每个接口返回 null。</li>
<li>应用无法对 <code>NETLINK_ROUTE</code> 套接字使用 <code>bind()</code> 函数。</li>
<li><code>IP</code> 命令不会返回有关接口的信息。</li>
</ul>
<p>这些变更强制执行不要使用 MAC 地址中提供的指导。</p>
<p>请注意，大多数开发者应使用级别较高的 <code>ConnectivityManager</code> API 而不是级别较低的 <code>NetworkInterface</code>/<code>getifaddrs()</code> API。</p>
<h3 id="每个进程的网络访问控制"><a href="#每个进程的网络访问控制" class="headerlink" title="每个进程的网络访问控制"></a><strong>每个进程的网络访问控制</strong></h3><p>从 Android 11 开始，处理敏感用户数据的应用可以向每个进程授予网络访问权限。通过明确指定允许哪些进程访问网络，您可以隔离不需要上传数据的所有代码。</p>
<p>虽然不能保证防止应用意外上传数据，但该功能可让降低应用中的错误导致数据泄露的几率。</p>
<p>下面显示了使用这项新功能的清单文件的示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;processes&gt;<br>        &lt;process /&gt;<br>        &lt;deny-permission android:name=<span class="hljs-string">&quot;android.permission.INTERNET&quot;</span> /&gt;<br>        &lt;process android:process=<span class="hljs-string">&quot;:withoutnet1&quot;</span> /&gt;<br>        &lt;process android:process=<span class="hljs-string">&quot;com.android.cts.useprocess.withnet1&quot;</span>&gt;<br>            &lt;allow-permission android:name=<span class="hljs-string">&quot;android.permission.INTERNET&quot;</span> /&gt;<br>        &lt;/process&gt;<br>        &lt;allow-permission android:name=<span class="hljs-string">&quot;android.permission.INTERNET&quot;</span> /&gt;<br>        &lt;process android:process=<span class="hljs-string">&quot;:withoutnet2&quot;</span>&gt;<br>            &lt;deny-permission android:name=<span class="hljs-string">&quot;android.permission.INTERNET&quot;</span> /&gt;<br>        &lt;/process&gt;<br>        &lt;process android:process=<span class="hljs-string">&quot;com.android.cts.useprocess.withnet2&quot;</span> /&gt;<br>    &lt;/processes&gt;<br></code></pre></td></tr></table></figure>

<h3 id="一次性权限"><a href="#一次性权限" class="headerlink" title="一次性权限"></a><strong>一次性权限</strong></h3><p>在 Android 11 中，每当应用请求与位置信息、麦克风或摄像头相关的权限时，应用都会获得临时的一次性权限。这个其实在苹果中也有类似的权限申请。</p>
<p>Android 11 不建议重复请求特定权限组中的权限。在您的应用安装到设备上后，如果用户在使用过程中两次针对某项特定的权限点按<strong>拒绝</strong>，此操作表示其希望以后请求相应权限组中的该权限时“不再询问”。</p>
<p>系统还对与点按<strong>拒绝</strong>选项相仿的操作的响应行为做出了定义：</p>
<ul>
<li>如果用户按返回按钮关闭权限对话框，此操作不算“拒绝”操作。</li>
<li>如果用户使用 [<code>requestPermissions()</code>](developer.android.google.cn/reference/a…(android.app.Activity, java.lang.String[], int)) 从您的应用转到系统设置，然后按返回按钮，此操作就算是“拒绝”操作。</li>
</ul>
<h3 id="悬浮窗口-intent-始终会将用户转至系统权限屏幕"><a href="#悬浮窗口-intent-始终会将用户转至系统权限屏幕" class="headerlink" title="悬浮窗口 intent 始终会将用户转至系统权限屏幕"></a>悬浮窗口 intent 始终会将用户转至系统权限屏幕</h3><p>从 Android 11 开始，<code>ACTION_MANAGE_OVERLAY_PERMISSION</code> intent 始终会将用户转至顶级<strong>设置</strong>屏幕，用户可在其中授予或撤消应用的 <code>SYSTEM_ALERT_WINDOW</code> 权限。intent 中的任何 <code>package:</code> 数据都会被忽略。</p>
<p>在更低版本的 Android 中，<code>ACTION_MANAGE_OVERLAY_PERMISSION</code> intent 可以指定一个文件包，它会将用户转至应用专用屏幕来管理权限。Android 11 不再支持此功能，而是必须由用户先选择要对其授予或撤消权限的应用。此变更可以让权限的授予更有目的性，从而达到保护用户的目的。</p>
<h3 id="限制非-SDK-接口"><a href="#限制非-SDK-接口" class="headerlink" title="限制非 SDK 接口"></a>限制非 SDK 接口</h3><p>如果应用并非以 Android 11 为目标平台，那么其中一些变更可能不会立即产生影响。虽然目前仍然可以使用灰名单中的一些非 SDK 接口（取决于应用的目标 API 级别），但如果使用任何非 SDK 方法或字段，则应用无法运行的风险终归较高。</p>
<p>如果不确定自己的应用是否使用了非 SDK 接口，则可以测试该应用，进行确认。如果应用依赖于非 SDK 接口，则应该开始计划迁移到 SDK 替代方案。如果无法为应用中的某项功能找到使用非 SDK 接口的替代方案，则应该请求新的公共 API。</p>
<h3 id="Open-Mobile-API-变更"><a href="#Open-Mobile-API-变更" class="headerlink" title="Open Mobile API 变更"></a>Open Mobile API 变更</h3><p>从 Android 11 开始，Open Mobile API (OMAPI) 有了额外的功能：</p>
<ul>
<li>解析运营商权限的规则。</li>
<li>使用以下一项或多项来自定义嵌入式安全元件 (eSE) 访问权限或配置 eSE：</li>
<li><ul>
<li>系统特许权限</li>
<li>可配置的访问规则应用主数据 (ARA-M) 应用标识符 (AID)</li>
<li>用于重置 OMAPI 读取器的系统 API</li>
</ul>
</li>
<li>为读取器提供清晰的指示符，以便应用过滤设备功能。</li>
</ul>
<h3 id="支持并发使用多个摄像头"><a href="#支持并发使用多个摄像头" class="headerlink" title="支持并发使用多个摄像头"></a>支持并发使用多个摄像头</h3><p>Android 11 添加了 API 来查询对同时使用多个摄像头（包括前置摄像头和后置摄像头）的支持。</p>
<p>要在运行应用的设备上检查支持情况，请使用以下方法：</p>
<ul>
<li><code>getConcurrentStreamingCameraIds()</code>可返回摄像头 ID 组合 <code>Set</code>，这些组合可与有保证的数据流组合并发进行流式传输（如果它们是由同一应用进程配置的）。</li>
<li><code>isConcurrentSessionConfigurationSupported() </code>可查询摄像头设备是否可以并发支持相应的会话配置。</li>
</ul>
<p>到这里本篇文章也到了尾声了，本文基本写完了安卓11更新的主要内容，大家可以根据应用实际情况进行准备，现在还不着急适配，真正需要适配的话应该还得好几个月。最后再放一下官网地址：<a target="_blank" rel="noopener" href="https://developer.android.google.cn/preview%E3%80%82%E5%A6%82%E6%9E%9C%E6%9C%AC%E6%96%87%E5%AF%B9%E4%BD%A0%E6%9C%89%E5%B8%AE%E5%8A%A9%E7%9A%84%E8%AF%9D%E8%AE%B0%E5%BE%97%E7%82%B9%E8%B5%9E%E5%85%B3%E6%B3%A8%E5%95%8A%EF%BC%8C%E6%84%9F%E6%BF%80%E4%B8%8D%E5%B0%BD%EF%BC%81%EF%BC%81%EF%BC%81">https://developer.android.google.cn/preview。如果本文对你有帮助的话记得点赞关注啊，感激不尽！！！</a></p>

      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>MengLong Sun</li>
    <li><strong>本文链接：</strong><a href="http://www.jianzhioffer.com/study/Android11%E9%80%82%E9%85%8D/index.html" title="http:&#x2F;&#x2F;www.jianzhioffer.com&#x2F;study&#x2F;Android11%E9%80%82%E9%85%8D&#x2F;index.html">http:&#x2F;&#x2F;www.jianzhioffer.com&#x2F;study&#x2F;Android11%E9%80%82%E9%85%8D&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
        
  <nav class="nav">
    <a href="/study/%E6%9F%A5%E7%9C%8BMD5%E5%80%BC/"><i class="iconfont iconleft"></i>查看文件MD5值</a>
    <a href="/study/android-strings.xml%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6/">android strings.xml转义字符, 注意细节解决<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-text">正文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%AD%98%E5%82%A8"><span class="toc-text">分区存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E8%AE%BE%E5%A4%87%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4"><span class="toc-text">管理设备存储空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-text">媒体文件访问权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6"><span class="toc-text">文件和目录访问限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90"><span class="toc-text">权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-text">所有文件访问权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E6%A1%86%E8%A7%86%E5%9B%BE%E8%A2%AB%E5%B1%8F%E8%94%BD"><span class="toc-text">自定义消息框视图被屏蔽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0%E6%9C%8D%E5%8A%A1%E7%B1%BB%E5%9E%8B"><span class="toc-text">** 前台服务类型**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAC-%E5%9C%B0%E5%9D%80"><span class="toc-text">MAC 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%8F%E4%B8%AA%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">每个进程的网络访问控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E6%80%A7%E6%9D%83%E9%99%90"><span class="toc-text">一次性权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%82%AC%E6%B5%AE%E7%AA%97%E5%8F%A3-intent-%E5%A7%8B%E7%BB%88%E4%BC%9A%E5%B0%86%E7%94%A8%E6%88%B7%E8%BD%AC%E8%87%B3%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90%E5%B1%8F%E5%B9%95"><span class="toc-text">悬浮窗口 intent 始终会将用户转至系统权限屏幕</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E9%9D%9E-SDK-%E6%8E%A5%E5%8F%A3"><span class="toc-text">限制非 SDK 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Open-Mobile-API-%E5%8F%98%E6%9B%B4"><span class="toc-text">Open Mobile API 变更</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E5%B9%B6%E5%8F%91%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-text">支持并发使用多个摄像头</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a><p><a target="_blank" href="https://beian.miit.gov.cn/">京ICP备20023327号-1</a></p></p></div>
  
</footer>
  
  
  
  
    <div class="search">
  <div class="search-container">
    <div class="search-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <div class="search-input-wrapper">
      <i class="search-input-icon iconfont iconsearch"></i>
      <input class="search-input" type="search" id="search-input" placeholder="Search..." autofocus autocomplete="off"
        autocorrect="off" autocapitalize="off">
    </div>
    <div class="search-output" id="search-output"></div>
  </div>
</div>
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>








<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>