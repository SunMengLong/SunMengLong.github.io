

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Android数据库GreenDao使用解析 - Android高级工程师</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="img
数据库GreenDao.jpg
之前在开发过程...">
  <meta name="author" content="MengLong Sun">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: false,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: false,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: true,
        path: 'search.xml'
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
      
      
        <i class="iconfont iconsearch j-navbar-search"></i>
      
    </div>
    <div class="center">Android数据库GreenDao使用解析</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 相册</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a><p><a target="_blank" href="https://beian.miit.gov.cn/">京ICP备20023327号-1</a></p></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/../../images/cover/cover_40.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">Android数据库GreenDao使用解析</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>August 24, 2021</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>41295</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <p><img    class="lazyload" data-original="../../images/webp.webp" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<p>数据库GreenDao.jpg</p>
<p>之前在开发过程中，数据库基本上会使用Litepal或者SQlite自己写，最近换新环境，公司原先使用的数据库就是GreenDao，在各种情况的作用下，准备了解下GreenDao，顺便写一篇文章记录下GreenDao的基本使用！如果你是Android开发者，你在开发路上遇到任何问题，欢迎来我的公众号给我留言，咱们一起讨论，加入的Android开发讨论小组，一起进步！文章转载请注明出处。</p>
<blockquote>
<p>本文主要从如下几个方面进行讲解</p>
<ol>
<li>存储的数据库结构</li>
<li>GreenDao的优缺点</li>
<li>GreenDao的使用配置</li>
<li>使用GreenDao实现数据的增删改查</li>
<li>GreenDao的注解使用</li>
<li>GreenDao的关系处理</li>
<li>GreenDao的升级</li>
<li>GreenDao数据库加密</li>
<li>项目地址<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://github.com/aserbao/AserbaosAndroid">AserbaosAndroid</a></li>
<li>总结</li>
<li>参考博客</li>
<li>简书暂时不支持目录，<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://blog.csdn.net/qq_32175491/article/details/82913904">如果想看该文章带目录版本，请点击跳转该文章的CSDN地址</a></li>
</ol>
</blockquote>
<p>咱们先看一波最终的效果图：文章最后有项目地址;</p>
<p><img    class="lazyload" data-original="https://upload-images.jianshu.io/upload_images/3965704-380337dcf6303758.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/292/format/webp" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<p>greendao</p>
<h1 id="1-存储的数据库结构"><a href="#1-存储的数据库结构" class="headerlink" title="1. 存储的数据库结构"></a>1. 存储的数据库结构</h1><p>学习数据库之前，我们先得设计自己的数据库，不多废话，下面是我此次学习的数据库结构，后面所有的数据请参考这个图进行学习：</p>
<p><img    class="lazyload" data-original="https://upload-images.jianshu.io/upload_images/3965704-5a95ace87186a409.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1143/format/webp" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<p>GreenDao关系图.jpg</p>
<h1 id="2-GreenDao的介绍"><a href="#2-GreenDao的介绍" class="headerlink" title="2. GreenDao的介绍"></a>2. GreenDao的介绍</h1><p>简单的GreenDao的介绍，嫌麻烦的可以直接跳到GreenDao使用开始看。</p>
<h2 id="什么是GreenDao？"><a href="#什么是GreenDao？" class="headerlink" title="什么是GreenDao？"></a>什么是GreenDao？</h2><p>GreenDAO是一个开源的Android ORM(“对象/关系映射”)，通过ORM（称为“对象/关系映射”），在我们数据库开发过程中节省了开发时间！</p>
<p><img    class="lazyload" data-original="https://upload-images.jianshu.io/upload_images/3965704-b5a94b75c040f6d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<p>GreenDao的原理.png</p>
<h2 id="GreenDao的官方文档"><a href="#GreenDao的官方文档" class="headerlink" title="GreenDao的官方文档"></a>GreenDao的官方文档</h2><ol>
<li><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://greenrobot.org/greendao/">GreenDao：适用于您的SQLite数据库的Android ORM</a></li>
<li><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://github.com/greenrobot/greenDAO">GreenDao的github地址</a></li>
<li><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://groups.google.com/forum/%23!forum/greendao">GreenDao的Google讨论区</a></li>
<li><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.zetetic.net/sqlcipher/sqlcipher-for-android/">GreenDao 加密SQLCipher for Android官方说明地址</a></li>
<li><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://greenrobot.org/greendao/documentation/">GreenDao使用文档</a></li>
</ol>
<h2 id="GreenDao的作用？"><a href="#GreenDao的作用？" class="headerlink" title="GreenDao的作用？"></a>GreenDao的作用？</h2><p>通过GreenDao，我们可以更快速的操作数据库，我们可以使用简单的面相对象的API来存储，更新，删除和查询Java对象。</p>
<h2 id="GreenDao的优缺点？"><a href="#GreenDao的优缺点？" class="headerlink" title="GreenDao的优缺点？"></a>GreenDao的优缺点？</h2><ol>
<li><p>高性能，下面是官方给出的关于GreenDao，OrmLite和ActiveAndroid三种ORM解决方案的数据统计图：</p>
<p><img    class="lazyload" data-original="https://upload-images.jianshu.io/upload_images/3965704-4b86f761a36ffb57.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1022/format/webp" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<p>GreenDao性能对比图.png</p>
</li>
<li><p>易于使用的强大API，涵盖关系和连接；</p>
</li>
<li><p>最小的内存消耗;</p>
</li>
<li><p>小库大小（&lt;100KB）以保持较低的构建时间并避免65k方法限制;</p>
</li>
<li><p>数据库加密：greenDAO支持SQLCipher，以确保用户的数据安全;</p>
</li>
</ol>
<h1 id="3-GreenDao的使用"><a href="#3-GreenDao的使用" class="headerlink" title="3. GreenDao的使用"></a>3. GreenDao的使用</h1><p>GreenDao的核心类有三个：分别是DaoMaster,DaoSession,XXXDao，这三个类都会自动创建，无需自己编写创建！</p>
<ul>
<li><p>DaoMaster:：DaoMaster保存数据库对象（SQLiteDatabase）并管理特定模式的DAO类（而不是对象）。它有静态方法来创建表或删除它们。它的内部类OpenHelper和DevOpenHelper是SQLiteOpenHelper实现，它们在SQLite数据库中创建模式。</p>
</li>
<li><p>DaoSession：管理特定模式的所有可用DAO对象，您可以使用其中一个getter方法获取该对象。DaoSession还提供了一些通用的持久性方法，如实体的插入，加载，更新，刷新和删除。</p>
</li>
<li><p>XXXDao：数据访问对象（DAO）持久存在并查询实体。对于每个实体，greenDAO生成DAO。它具有比DaoSession更多的持久性方法，例如：count，loadAll和insertInTx。</p>
</li>
<li><p>Entities ：可持久化对象。通常, 实体对象代表一个数据库行使用标准 Java 属性(如一个POJO 或 JavaBean )。</p>
</li>
<li><p><img    class="lazyload" data-original="https://upload-images.jianshu.io/upload_images/3965704-b14ec30195c9eaa7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/150/format/webp" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<p>GreenDao核心.png</p>
</li>
</ul>
<h2 id="1-导入Gradle插件和Dao代码生成"><a href="#1-导入Gradle插件和Dao代码生成" class="headerlink" title="1. 导入Gradle插件和Dao代码生成"></a>1. 导入Gradle插件和Dao代码生成</h2><p>要在Android项目中使用GreenDao，您需要添加GreenDao Gradle插件并添加GreenDao库：</p>
<ol>
<li>导入插件</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// 在 Project的build.gradle 文件中添加:</span><br>buildscript &#123;<br>    repositories &#123;<br>        jcenter()<br>        mavenCentral() <span class="hljs-comment">// add repository</span><br>    &#125;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;com.android.tools.build:gradle:3.1.2&#x27;</span><br>        classpath <span class="hljs-string">&#x27;org.greenrobot:greendao-gradle-plugin:3.2.2&#x27;</span> <span class="hljs-comment">// add plugin</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li>配置相关依赖</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// 在 Moudle:app的  build.gradle 文件中添加:</span><br>apply plugin: <span class="hljs-string">&#x27;com.android.application&#x27;</span><br>apply plugin: <span class="hljs-string">&#x27;org.greenrobot.greendao&#x27;</span> <span class="hljs-comment">// apply plugin</span><br> <br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;org.greenrobot:greendao:3.2.2&#x27;</span> <span class="hljs-comment">// add library</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li>配置数据库相关信息</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs csharp">greendao &#123;<br>    schemaVersion <span class="hljs-number">1</span> <span class="hljs-comment">//数据库版本号</span><br>    daoPackage <span class="hljs-string">&#x27;com.aserbao.aserbaosandroid.functions.database.greenDao.db&#x27;</span><br><span class="hljs-comment">// 设置DaoMaster、DaoSession、Dao 包名</span><br>    targetGenDir <span class="hljs-string">&#x27;src/main/java&#x27;</span><span class="hljs-comment">//设置DaoMaster、DaoSession、Dao目录,请注意，这里路径用/不要用.</span><br>    generateTests <span class="hljs-literal">false</span> <span class="hljs-comment">//设置为true以自动生成单元测试。</span><br>    targetGenDirTests <span class="hljs-string">&#x27;src/main/java&#x27;</span> <span class="hljs-comment">//应存储生成的单元测试的基本目录。默认为 src / androidTest / java。</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>配置完成，在Android Studio中使用Build&gt; Make Project，重写build项目，GreenDao集成完成！</p>
<h2 id="2-创建存储对象实体类"><a href="#2-创建存储对象实体类" class="headerlink" title="2. 创建存储对象实体类"></a>2. 创建存储对象实体类</h2><p>使用GreenDao存储数据只需要在存储数据类前面声明@Entity注解就让GreenDao为其生成必要的代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span>(autoincrement = <span class="hljs-keyword">true</span>)<br>    Long id;<br>    <span class="hljs-meta">@Unique</span><br>    <span class="hljs-built_in">int</span> studentNo;<span class="hljs-comment">//学号</span><br>    <span class="hljs-built_in">int</span> age; <span class="hljs-comment">//年龄</span><br>    <span class="hljs-built_in">String</span> telPhone;<span class="hljs-comment">//手机号</span><br>    <span class="hljs-built_in">String</span> sex; <span class="hljs-comment">//性别</span><br>    <span class="hljs-built_in">String</span> name;<span class="hljs-comment">//姓名</span><br>    <span class="hljs-built_in">String</span> address;<span class="hljs-comment">//家庭住址</span><br>    <span class="hljs-built_in">String</span> schoolName;<span class="hljs-comment">//学校名字</span><br>    <span class="hljs-built_in">String</span> grade;<span class="hljs-comment">//几年级</span><br>    ……getter and setter and constructor method……<br>    &#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-GreenDao初始化"><a href="#3-GreenDao初始化" class="headerlink" title="3. GreenDao初始化"></a>3. GreenDao初始化</h2><p>我们可以在Application中维持一个全局的会话。我们在Applicaiton进行数据库的初始化操作：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 初始化GreenDao,直接在Application中进行初始化操作</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initGreenDao</span><span class="hljs-params">()</span> </span>&#123;<br>       DaoMaster.DevOpenHelper helper = <span class="hljs-keyword">new</span> DaoMaster.<span class="hljs-built_in">DevOpenHelper</span>(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;aserbao.db&quot;</span>);<br>       SQLiteDatabase db = helper.<span class="hljs-built_in">getWritableDatabase</span>();<br>       DaoMaster daoMaster = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DaoMaster</span>(db);<br>       daoSession = daoMaster.<span class="hljs-built_in">newSession</span>();<br>   &#125;<br>   <br>   <span class="hljs-keyword">private</span> DaoSession daoSession;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> DaoSession <span class="hljs-title">getDaoSession</span><span class="hljs-params">()</span> </span>&#123;<br>       <span class="hljs-keyword">return</span> daoSession;<br>   &#125;<br></code></pre></td></tr></table></figure>

<p>初始化完成之后重新rebuild一下项目会发现在设置的targetGenDir的目录生成三个类文件，这个是GreenDao自动生成的！说明数据库已经连接好了，咱们接下来只需要进行数据库的增删改查操作就行了。Let’s Go!</p>
<h2 id="4-使用GreenDao实现增删改查"><a href="#4-使用GreenDao实现增删改查" class="headerlink" title="4. 使用GreenDao实现增删改查"></a>4. 使用GreenDao实现增删改查</h2><h3 id="1-增"><a href="#1-增" class="headerlink" title="1. 增"></a>1. 增</h3><p><strong>insert()</strong> 插入数据</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Override</span><br>   public <span class="hljs-keyword">void</span> insertData(Thing s) &#123;<br>    DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>           <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>              Student student = <span class="hljs-keyword">new</span> Student();<br>                       student.setStudentNo(i);<br>                       <span class="hljs-built_in">int</span> age = mRandom.nextInt(<span class="hljs-number">10</span>) + <span class="hljs-number">10</span>;<br>                       student.setAge(age);<br>                       student.setTelPhone(RandomValue.getTel());<br>                       <span class="hljs-built_in">String</span> chineseName = RandomValue.getChineseName();<br>                       student.setName(chineseName);<br>                       <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>                           student.setSex(<span class="hljs-string">&quot;男&quot;</span>);<br>                       &#125; <span class="hljs-keyword">else</span> &#123;<br>                           student.setSex(<span class="hljs-string">&quot;女&quot;</span>);<br>                       &#125;<br>                       student.setAddress(RandomValue.getRoad());<br>                       student.setGrade(<span class="hljs-built_in">String</span>.valueOf(age % <span class="hljs-number">10</span>) + <span class="hljs-string">&quot;年纪&quot;</span>);<br>                       student.setSchoolName(RandomValue.getSchoolName());<br>                       daoSession.insert(student);<br>           &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>

<p>**insertOrReplace()**数据存在则替换，数据不存在则插入</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Override</span><br>    public <span class="hljs-keyword">void</span> insertData(Thing s) &#123;<br>    DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>                 Student student = <span class="hljs-keyword">new</span> Student();<br>                        student.setStudentNo(i);<br>                        <span class="hljs-built_in">int</span> age = mRandom.nextInt(<span class="hljs-number">10</span>) + <span class="hljs-number">10</span>;<br>                        student.setAge(age);<br>                        student.setTelPhone(RandomValue.getTel());<br>                        <span class="hljs-built_in">String</span> chineseName = RandomValue.getChineseName();<br>                        student.setName(chineseName);<br>                        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>                            student.setSex(<span class="hljs-string">&quot;男&quot;</span>);<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            student.setSex(<span class="hljs-string">&quot;女&quot;</span>);<br>                        &#125;<br>                        student.setAddress(RandomValue.getRoad());<br>                        student.setGrade(<span class="hljs-built_in">String</span>.valueOf(age % <span class="hljs-number">10</span>) + <span class="hljs-string">&quot;年纪&quot;</span>);<br>                        student.setSchoolName(RandomValue.getSchoolName());<br>                        daoSession.insertOrReplace(student);<span class="hljs-comment">//插入或替换</span><br>            &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-删"><a href="#2-删" class="headerlink" title="2. 删"></a>2. 删</h3><p>删除有两种方式：delete()和deleteAll()；分别表示删除单个和删除所有。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">@<span class="hljs-function">Override</span><br><span class="hljs-function">   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteData</span><span class="hljs-params">(Student s)</span> </span>&#123;<br>       DaoSession daoSession = ((AserbaoApplication) <span class="hljs-built_in">getApplication</span>()).<span class="hljs-built_in">getDaoSession</span>();<br>       daoSession.<span class="hljs-built_in"><span class="hljs-keyword">delete</span></span>(s);<br>   &#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteAll</span><span class="hljs-params">()</span> </span>&#123;<br>       DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>       daoSession.deleteAll(Student.class);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-改"><a href="#3-改" class="headerlink" title="3. 改"></a>3. 改</h3><p>通过update来进行修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updataData</span><span class="hljs-params">(Student s)</span> </span>&#123;<br>        DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>        daoSession.update(s);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-查"><a href="#4-查" class="headerlink" title="4. 查"></a>4. 查</h3><p>查询的方法有：</p>
<ul>
<li>loadAll()：查询所有数据。</li>
<li>queryRaw()：根据条件查询。</li>
<li>queryBuilder() : 方便查询的创建，后面详细讲解。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">queryAll</span><span class="hljs-params">()</span></span>&#123;<br>       List&lt;Student&gt; students = daoSession.loadAll(Student.class);<br>       <span class="hljs-keyword">return</span> students;<br>   &#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> void queryData(String s) &#123;<br>     List&lt;Student&gt; students = daoSession.queryRaw(Student.<span class="hljs-keyword">class</span>, <span class="hljs-string">&quot; where id = ?&quot;</span>, s);<br>      mDataBaseAdapter.addNewStudentData(students);<br>  &#125;<br></code></pre></td></tr></table></figure>

<h1 id="4-QueryBuilder的使用"><a href="#4-QueryBuilder的使用" class="headerlink" title="4. QueryBuilder的使用"></a>4. QueryBuilder的使用</h1><p>编写SQL可能很困难并且容易出现错误，这些错误仅在运行时才会被注意到。该QueryBuilder的类可以让你建立你的实体，而不SQL自定义查询，并有助于在编译时已检测错误。</p>
<p>我们先讲下QueryBuilder的常见方法：</p>
<ul>
<li>where(WhereCondition cond, WhereCondition… condMore): 查询条件，参数为查询的条件！</li>
<li>or(WhereCondition cond1, WhereCondition cond2, WhereCondition… condMore): 嵌套条件或者，用法同or。</li>
<li>and(WhereCondition cond1, WhereCondition cond2, WhereCondition… condMore): 嵌套条件且，用法同and。</li>
<li>join(Property sourceProperty, Class<J> destinationEntityClass):多表查询，后面会讲。<br> 输出结果有四种方式，选择其中一种最适合的即可，list()返回值是List,而其他三种返回值均实现Closeable,需要注意的不使用数据时游标的关闭操作：</li>
<li>list （）所有实体都加载到内存中。结果通常是一个没有魔法的 ArrayList。最容易使用。</li>
<li>listLazy （）实体按需加载到内存中。首次访问列表中的元素后，将加载并缓存该元素以供将来使用。必须关闭。</li>
<li>listLazyUncached （）实体的“虚拟”列表：对列表元素的任何访问都会导致从数据库加载其数据。必须关闭。</li>
<li>listIterator （）让我们通过按需加载数据（懒惰）来迭代结果。数据未缓存。必须关闭。</li>
<li>orderAsc() 按某个属性升序排；</li>
<li>orderDesc() 按某个属性降序排；</li>
</ul>
<p>GreenDao中SQL语句的缩写，我们也了解下，源码在Property中,使用的时候可以自己点进去查询即可：</p>
<ul>
<li>eq()：”equal (‘=?’)” 等于；</li>
<li>notEq() ：”not equal (‘&lt;&gt;?’)” 不等于；</li>
<li>like()：” LIKE ?” 值等于；</li>
<li>between()：” BETWEEN ? AND ?” 取中间范围；</li>
<li>in()：” IN (“  in命令;</li>
<li>notIn()：” NOT IN (“ not in 命令;</li>
<li>gt()：”&gt;?”  大于;</li>
<li>lt()：”&lt;? “  小于;</li>
<li>ge()：”&gt;=?”  大于等于;</li>
<li>le()：”&lt;=? “  小于等于;</li>
<li>isNull()：” IS NULL” 为空;</li>
<li>isNotNull()：” IS NOT NULL” 不为空;</li>
</ul>
<h2 id="1-使用QueryBuilder进行查询操作"><a href="#1-使用QueryBuilder进行查询操作" class="headerlink" title="1. 使用QueryBuilder进行查询操作"></a>1. 使用QueryBuilder进行查询操作</h2><h3 id="1-简单条件查询"><a href="#1-简单条件查询" class="headerlink" title="1. 简单条件查询"></a>1. 简单条件查询</h3><p>查询当前Student表的所有的数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">queryAllList</span><span class="hljs-params">()</span></span>&#123;<br>      DaoSession daoSession = ((AserbaoApplication) <span class="hljs-built_in">getApplication</span>()).<span class="hljs-built_in">getDaoSession</span>();<br>      QueryBuilder&lt;Student&gt; qb = daoSession.<span class="hljs-built_in">queryBuilder</span>(Student.class);<br>      List&lt;Student&gt; list = qb.<span class="hljs-built_in">list</span>(); <span class="hljs-comment">// 查出所有的数据</span><br>  <span class="hljs-keyword">return</span> list;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>查询Name为“一”的所有Student:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> List queryListByMessage(String name)&#123;<br>        DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>       QueryBuilder&lt;Student&gt; qb = daoSession.queryBuilder(Student.<span class="hljs-keyword">class</span>);<br>       QueryBuilder&lt;Student&gt; studentQueryBuilder = qb.<span class="hljs-keyword">where</span>(StudentDao.Properties.Name.eq(<span class="hljs-string">&quot;一&quot;</span>)).orderAsc(StudentDao.Properties.Name);<br>       List&lt;Student&gt; studentList = studentQueryBuilder.list(); <span class="hljs-comment">//查出当前对应的数据</span><br>       <span class="hljs-keyword">return</span> list;<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-原始查询"><a href="#2-原始查询" class="headerlink" title="2. 原始查询"></a>2. 原始查询</h3><p>通过原始的SQL查询语句进行查询！其实上面有提到QueryBuilder的目的就是方便快捷的编写SQL查询语句，避免我们自己在编写过程中出错！简单介绍下通过QueryBuilder编写数据库，方式方法如下 ：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">queryListBySqL</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-comment">// 查询ID大于5的所有学生</span><br>        DaoSession daoSession = ((AserbaoApplication) <span class="hljs-built_in">getApplication</span>()).<span class="hljs-built_in">getDaoSession</span>();<br>        Query&lt;Student&gt; query = daoSession.<span class="hljs-built_in">queryBuilder</span>(Student.class).<span class="hljs-built_in">where</span>(<br>                <span class="hljs-keyword">new</span> WhereCondition.<span class="hljs-built_in">StringCondition</span>(<span class="hljs-string">&quot;_ID IN &quot;</span> +<br>                        <span class="hljs-string">&quot;(SELECT _ID FROM STUDENT WHERE _ID &gt; 5)&quot;</span>)<br>        ).<span class="hljs-built_in">build</span>();<br>        List&lt;Student&gt; list = query.<span class="hljs-built_in">list</span>();<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-嵌套条件查询"><a href="#3-嵌套条件查询" class="headerlink" title="3. 嵌套条件查询"></a>3. 嵌套条件查询</h3><p>查询Id大于5小于10，且Name值为”一”的数据：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> List queryList()&#123;<br>        DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>        QueryBuilder&lt;Student&gt; qb = daoSession.queryBuilder(Student.<span class="hljs-keyword">class</span>);<br>        qb = daoSession.queryBuilder(Student.<span class="hljs-keyword">class</span>);<br>        List&lt;Student&gt; list2 = qb.<span class="hljs-keyword">where</span>(StudentDao.Properties.Name.eq(<span class="hljs-string">&quot;一&quot;</span>),<br>                qb.and(StudentDao.Properties.Id.gt(<span class="hljs-number">5</span>),<br>                        StudentDao.Properties.Id.le(<span class="hljs-number">50</span>))).list();<br>        <span class="hljs-keyword">return</span>  list2;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>取10条Id大于1的数据，且偏移2条</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">queryListByOther</span><span class="hljs-params">()</span></span>&#123;<br>       DaoSession daoSession = ((AserbaoApplication) <span class="hljs-built_in">getApplication</span>()).<span class="hljs-built_in">getDaoSession</span>();<br>       QueryBuilder&lt;Student&gt; qb = daoSession.<span class="hljs-built_in">queryBuilder</span>(Student.class);<br><br>       <span class="hljs-comment">//搜索条件为Id值大于1，即结果为[2,3,4,5,6,7,8,9,10,11];</span><br>       <span class="hljs-comment">// offset(2)表示往后偏移2个，结果为[4,5,6,7,8,9,10,11,12,13];</span><br>       List&lt;Student&gt; list = qb.<span class="hljs-built_in">where</span>(StudentDao.Properties.Id.<span class="hljs-built_in">gt</span>(<span class="hljs-number">1</span>)).<span class="hljs-built_in">limit</span>(<span class="hljs-number">10</span>).<span class="hljs-built_in">offset</span>(<span class="hljs-number">2</span>).<span class="hljs-built_in">list</span>();<br>       <span class="hljs-keyword">return</span> list;<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-多次执行查找"><a href="#4-多次执行查找" class="headerlink" title="4. 多次执行查找"></a>4. 多次执行查找</h3><p>使用QueryBuilder构建查询后，可以重用 Query对象以便稍后执行查询。这比始终创建新的Query对象更有效。如果查询参数没有更改，您可以再次调用list / unique方法。可以通过setParameter方法来修改条件参数值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">queryListByMoreTime</span><span class="hljs-params">()</span></span>&#123;<br>       DaoSession daoSession = ((AserbaoApplication) <span class="hljs-built_in">getApplication</span>()).<span class="hljs-built_in">getDaoSession</span>();<br>       QueryBuilder&lt;Student&gt; qb = daoSession.<span class="hljs-built_in">queryBuilder</span>(Student.class);<br><br>       <span class="hljs-comment">//搜索条件为Id值大于1，即结果为[2,3,4,5,6,7,8,9,10,11];</span><br>       <span class="hljs-comment">// offset(2)表示往后偏移2个，结果为[4,5,6,7,8,9,10,11,12,13];</span><br>       Query&lt;Student&gt; query = qb.<span class="hljs-built_in">where</span>(StudentDao.Properties.Id.<span class="hljs-built_in">gt</span>(<span class="hljs-number">1</span>)).<span class="hljs-built_in">limit</span>(<span class="hljs-number">10</span>).<span class="hljs-built_in">offset</span>(<span class="hljs-number">2</span>).<span class="hljs-built_in">build</span>();<br>       List&lt;Student&gt; list = query.<span class="hljs-built_in">list</span>();<br>       <br>       <span class="hljs-comment">//通过SetParameter来修改上面的查询条件，比如我们将上面条件修改取10条Id值大于5，往后偏移两位的数据，方法如下！</span><br>       query.<span class="hljs-built_in">setParameter</span>(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);<br>       List&lt;Student&gt; list1 = query.<span class="hljs-built_in">list</span>();<br>       <span class="hljs-keyword">return</span> list1;<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-在多个线程中使用QueryBuilder"><a href="#5-在多个线程中使用QueryBuilder" class="headerlink" title="5. 在多个线程中使用QueryBuilder"></a>5. 在多个线程中使用QueryBuilder</h3><p>如果在多个线程中使用查询，则必须调用 forCurrentThread （）以获取当前线程的Query实例。Query的对象实例绑定到构建查询的拥有线程。</p>
<p>这使您可以安全地在Query对象上设置参数，而其他线程不会干扰。如果其他线程尝试在查询上设置参数或执行绑定到另一个线程的查询，则会抛出异常。像这样，您不需要同步语句。实际上，您应该避免锁定，因为如果并发事务使用相同的Query对象，这可能会导致死锁。</p>
<p>每次调用forCurrentThread （）时， 参数都会在使用其构建器构建查询时设置为初始参数。</p>
<h2 id="2-使用QueryBuilder进行批量删除操作"><a href="#2-使用QueryBuilder进行批量删除操作" class="headerlink" title="2. 使用QueryBuilder进行批量删除操作"></a>2. 使用QueryBuilder进行批量删除操作</h2><p>使用QueryBuilder进行批量删除操作，不会删除单个实体，但会删除符合某些条件的所有实体。要执行批量删除，请创建QueryBuilder，调用其 buildDelete （）方法，然后执行返回的 DeleteQuery。</p>
<p>例子：删除数据库中id大于5的所有其他数据</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> boolean deleteItem()&#123;<br>        DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>        QueryBuilder&lt;Student&gt; <span class="hljs-keyword">where</span> = daoSession.queryBuilder(Student.<span class="hljs-keyword">class</span>).<span class="hljs-keyword">where</span>(StudentDao.Properties.Id.gt(<span class="hljs-number">5</span>));<br>        DeleteQuery&lt;Student&gt; deleteQuery = <span class="hljs-keyword">where</span>.buildDelete();<br>        deleteQuery.executeDeleteWithoutDetachingEntities();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<h1 id="5-注解讲解"><a href="#5-注解讲解" class="headerlink" title="5. 注解讲解"></a>5. 注解讲解</h1><p>从GreenDao 3 使用注解来定义模型和实体，前面也讲过，通过注解的使用可以快速构建数据库表，包括设置主键，自增，值是否唯一等等等……</p>
<p>下面我们来看下注解的简单使用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span>(autoincrement = <span class="hljs-keyword">true</span>)<br>    Long id;<br>    <span class="hljs-meta">@Unique</span><br>    <span class="hljs-built_in">int</span> studentNo;<span class="hljs-comment">//学号</span><br>    <span class="hljs-built_in">int</span> age; <span class="hljs-comment">//年龄</span><br>    <span class="hljs-built_in">String</span> telPhone;<span class="hljs-comment">//手机号</span><br>    <span class="hljs-built_in">String</span> sex; <span class="hljs-comment">//性别</span><br>    <span class="hljs-built_in">String</span> name;<span class="hljs-comment">//姓名</span><br>    <span class="hljs-built_in">String</span> address;<span class="hljs-comment">//家庭住址</span><br>    <span class="hljs-built_in">String</span> schoolName;<span class="hljs-comment">//学校名字</span><br>    <span class="hljs-built_in">String</span> grade;<span class="hljs-comment">//几年级</span><br>    ……getter and setter and constructor method……<br>    &#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-Entity注解"><a href="#1-Entity注解" class="headerlink" title="1. @Entity注解"></a>1. @Entity注解</h2><p>@Entity是GreenDao必不可少的注解，只有在实体类中使用了@Entity注解GreenDao才会创建对应的表。当然我们也可以使用@Entity配置一些细节：</p>
<ul>
<li>schema：如果你有多个架构，你可以告诉GreenDao当前属于哪个架构。</li>
<li>active：标记一个实体处于活跃状态，活动实体有更新、删除和刷新方法。</li>
<li>nameInDb：在数据中使用的别名，默认使用的是实体的类名。</li>
<li>indexes：标记如果DAO应该创建数据库表(默认为true)，如果您有多个实体映射到一个表，或者表的创建是在greenDAO之外进行的，那么将其设置为false。</li>
<li>createInDb：标记创建数据库表。</li>
<li>generateGettersSetters：如果缺少，是否应生成属性的getter和setter方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Entity(</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">        schema = &quot;myschema&quot;,</span><br><span class="hljs-meta">        active = true,</span><br><span class="hljs-meta">        nameInDb = &quot;AWESOME_USERS&quot;,</span><br><span class="hljs-meta">        indexes = &#123;</span><br><span class="hljs-meta">                @Index(value = &quot;message DESC&quot;, unique = true)</span><br><span class="hljs-meta">        &#125;,</span><br><span class="hljs-meta">        createInDb = false,</span><br><span class="hljs-meta">        generateConstructors = true,</span><br><span class="hljs-meta">        generateGettersSetters = true</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span></span>&#123;   <br>    ……<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-基础属性注解（-Id，-Property，-NotNull，-Transient）"><a href="#2-基础属性注解（-Id，-Property，-NotNull，-Transient）" class="headerlink" title="2.  基础属性注解（@Id，@Property，@NotNull，@Transient）"></a>2.  基础属性注解（@Id，@Property，@NotNull，@Transient）</h2><p><strong>@Id</strong><br> @Id注解选择 long / Long属性作为实体ID。在数据库方面，它是主键。参数autoincrement = true 表示自增，id不给赋值或者为赋值为null即可（这里需要注意，如果要实现自增，id必须是Long,为long不行！)。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Id(autoincrement = true)</span><br>    <span class="hljs-built_in">Long</span> id;<br>    ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>@Property</strong><br> 允许您定义属性映射到的非默认列名。如果不存在，GreenDAO将以SQL-ish方式使用字段名称（大写，下划线而不是camel情况，例如 name将成为 NAME）。注意：您当前只能使用内联常量来指定列名。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@Entity</span><br>public class Student &#123;<br>    <span class="hljs-keyword">@Id</span>(autoincrement = true)<br>    Long id;<br>    <span class="hljs-keyword">@Property</span> (nameInDb=<span class="hljs-string">&quot;name&quot;</span>) //设置了，数据库中的表格属性名为<span class="hljs-string">&quot;name&quot;</span>,如果不设置，数据库中表格属性名为<span class="hljs-string">&quot;NAME&quot;</span><br>    String name;<br>    ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>@NotNull</strong> ：设置数据库表当前列不能为空 。</p>
<p><strong>@Transient</strong> ：添加次标记之后不会生成数据库表的列。标记要从持久性中排除的属性。将它们用于临时状态等。或者，您也可以使用Java中的transient关键字。</p>
<h2 id="3-索引注解"><a href="#3-索引注解" class="headerlink" title="3. 索引注解"></a>3. 索引注解</h2><ul>
<li>@Index：使用@Index作为一个属性来创建一个索引，通过name设置索引别名，也可以通过unique给索引添加约束。</li>
<li>@Unique：向索引添加UNIQUE约束，强制所有值都是唯一的。</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Id(autoincrement = true)</span><br>    <span class="hljs-built_in">Long</span> id;<br>    <span class="hljs-meta">@Property(nameInDb=<span class="hljs-meta-string">&quot;name&quot;</span>)</span><br>    <span class="hljs-meta">@Index(unique = true)</span><br>     String name;<br>    ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>注意：</strong> 上面这种情况，约定name为唯一值，向数据库中通过insert方法继续添加已存在的name数据，会抛异常：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">10</span>-<span class="hljs-number">08</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">46.274</span> <span class="hljs-number">31939</span>-<span class="hljs-number">31939</span>/com.example.aserbao.aserbaosandroid E/AndroidRuntime: FATAL <span class="hljs-built_in">EXCEPTION</span>: main<br>    Process: com.example.aserbao.aserbaosandroid, PID: <span class="hljs-number">31939</span><br>    android.database.sqlite.SQLiteConstraintException: UNIQUE constraint failed: STUDENT.name (Sqlite code <span class="hljs-number">2067</span>), (OS <span class="hljs-built_in">error</span> - <span class="hljs-number">2</span>:No such file <span class="hljs-keyword">or</span> <span class="hljs-built_in">directory</span>)<br>    ……<br></code></pre></td></tr></table></figure>

<p>若使用insertOrReplace()方法添加数据，当前数据库中不会有重复的数据，但是重复的这条数据的id会被修改！若项目中有用到id字段进行排序的话，这一点需要特别注意。</p>
<h2 id="4-关系注解"><a href="#4-关系注解" class="headerlink" title="4. 关系注解"></a>4. 关系注解</h2><p>关系型注解GreenDao中主要就两个：</p>
<ul>
<li>@ToOne：定义与另一个实体（一个实体对象）的关系</li>
<li>@ToMany：定义与多个实体对象的关系<br> 至于如何使用，我们马上就讲。</li>
</ul>
<h1 id="6-一对一，一对多，多对多关系表的创建"><a href="#6-一对一，一对多，多对多关系表的创建" class="headerlink" title="6. 一对一，一对多，多对多关系表的创建"></a>6. 一对一，一对多，多对多关系表的创建</h1><p>平常项目中，我们经常会使用到多表关联，如文章开头所说的数据库表结构设置的那样！接下来我们来讲如何通过GreenDao实现多表关联。</p>
<h2 id="1-一对一"><a href="#1-一对一" class="headerlink" title="1. 一对一"></a>1. 一对一</h2><p>一个学生对应一个身份证号:<br> 做法：</p>
<ol>
<li>我们在Student中设置一个注解@ToOne(joinProperty = “name”)</li>
<li>在创建Student的时候，将对应的数据传递给IdCard;<br> 代码部分：</li>
</ol>
<p>学生Student代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span>(autoincrement = <span class="hljs-keyword">true</span>)<br>    Long id;<br>    <span class="hljs-meta">@Unique</span><br>    <span class="hljs-built_in">int</span> studentNo;<span class="hljs-comment">//学号</span><br>    <span class="hljs-built_in">int</span> age; <span class="hljs-comment">//年龄</span><br>    <span class="hljs-built_in">String</span> telPhone;<span class="hljs-comment">//手机号</span><br>    <span class="hljs-built_in">String</span> sex; <span class="hljs-comment">//性别</span><br>    <span class="hljs-built_in">String</span> name;<span class="hljs-comment">//姓名</span><br>    <span class="hljs-built_in">String</span> address;<span class="hljs-comment">//家庭住址</span><br>    <span class="hljs-built_in">String</span> schoolName;<span class="hljs-comment">//学校名字</span><br>    <span class="hljs-built_in">String</span> grade;<span class="hljs-comment">//几年级</span><br>    <span class="hljs-meta">@ToOne</span>(joinProperty = <span class="hljs-string">&quot;name&quot;</span>)<br>    IdCard student;<br>    ……getter and setter ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p>身份证IdCard代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdCard</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span> <br>    <span class="hljs-built_in">String</span> userName;<span class="hljs-comment">//用户名</span><br>    <span class="hljs-meta">@Unique</span><br>    <span class="hljs-built_in">String</span> idNo;<span class="hljs-comment">//身份证号</span><br>       ……getter and setter ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p>insert一组数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addStudent</span><span class="hljs-params">()</span></span>&#123;<br>                        DaoSession daoSession = ((AserbaoApplication) <span class="hljs-built_in">getApplication</span>()).<span class="hljs-built_in">getDaoSession</span>();<br>                        Student student = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Student</span>();<br>                        student.<span class="hljs-built_in">setStudentNo</span>(i);<br>                        <span class="hljs-keyword">int</span> age = mRandom.<span class="hljs-built_in">nextInt</span>(<span class="hljs-number">10</span>) + <span class="hljs-number">10</span>;<br>                        student.<span class="hljs-built_in">setAge</span>(age);<br>                        student.<span class="hljs-built_in">setTelPhone</span>(RandomValue.<span class="hljs-built_in">getTel</span>());<br>                        String chineseName = RandomValue.<span class="hljs-built_in">getChineseName</span>();<br>                        student.<span class="hljs-built_in">setName</span>(chineseName);<br>                        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>                            student.<span class="hljs-built_in">setSex</span>(<span class="hljs-string">&quot;男&quot;</span>);<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            student.<span class="hljs-built_in">setSex</span>(<span class="hljs-string">&quot;女&quot;</span>);<br>                        &#125;<br>                        student.<span class="hljs-built_in">setAddress</span>(RandomValue.<span class="hljs-built_in">getRoad</span>());<br>                        student.<span class="hljs-built_in">setGrade</span>(String.<span class="hljs-built_in">valueOf</span>(age % <span class="hljs-number">10</span>) + <span class="hljs-string">&quot;年纪&quot;</span>);<br>                        student.<span class="hljs-built_in">setSchoolName</span>(RandomValue.<span class="hljs-built_in">getSchoolName</span>());<br>                        daoSession.<span class="hljs-built_in">insert</span>(student);<br>                        <br>                        <span class="hljs-comment">//插入对应的IdCard数据</span><br>                        IdCard idCard = <span class="hljs-keyword">new</span> <span class="hljs-built_in">IdCard</span>();<br>                        idCard.<span class="hljs-built_in">setUserName</span>(userName);<br>                        idCard.<span class="hljs-built_in">setIdNo</span>(RandomValue.<span class="hljs-built_in">getRandomID</span>());<br>                        daoSession.<span class="hljs-built_in">insert</span>(idCard);<br>      &#125;<br></code></pre></td></tr></table></figure>

<p>ok,数据可以了！现在数据库表插入完成了。</p>
<h2 id="2-一对多"><a href="#2-一对多" class="headerlink" title="2. 一对多"></a>2. 一对多</h2><p>一个人拥有多个信用卡<br> 做法：</p>
<ol>
<li>在我们在Student中设置@ToMany(referencedJoinProperty = “studentId”);</li>
<li>我们在CreditCard中设置编写对应的id主键；</li>
</ol>
<p>Student的代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> &#123;</span><br>    <span class="hljs-variable">@Id</span>(autoincrement = <span class="hljs-literal">true</span>)<br>    Long id;<br><br>    <span class="hljs-variable">@Unique</span><br>    int studentNo;<span class="hljs-regexp">//</span>学号<br><br>    int age; <span class="hljs-regexp">//</span>年龄<br>    String telPhone;<span class="hljs-regexp">//</span>手机号<br>    String sex; <span class="hljs-regexp">//</span>性别<br>    String name;<span class="hljs-regexp">//</span>姓名<br>    String address;<span class="hljs-regexp">//</span>家庭住址<br>    String schoolName;<span class="hljs-regexp">//</span>学校名字<br>    String grade;<span class="hljs-regexp">//</span>几年级<br>    <br>    <span class="hljs-variable">@ToMany</span>(referencedJoinProperty = <span class="hljs-string">&quot;studentId) // 这个studentId是对应在CreditCard中的studentId</span><br><span class="hljs-string">    List&lt;CreditCard&gt; creditCardsList;</span><br><span class="hljs-string">      ……getter and setter ……</span><br><span class="hljs-string">    &#125;</span><br></code></pre></td></tr></table></figure>

<p>CreditCard的代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreditCard</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span><br>    Long id;<br>    Long studentId;<br>    Long teacherId;<br>    <span class="hljs-built_in">String</span> userName;<span class="hljs-comment">//持有者名字</span><br>    <span class="hljs-built_in">String</span> cardNum;<span class="hljs-comment">//卡号</span><br>    <span class="hljs-built_in">String</span> whichBank;<span class="hljs-comment">//哪个银行的</span><br>    <span class="hljs-built_in">int</span> cardType;<span class="hljs-comment">//卡等级，分类 0 ~ 5</span><br>     ……getter and setter ……<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>添加数据代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart">public <span class="hljs-keyword">void</span> addStudent()&#123;<br>                        DaoSession daoSession = ((AserbaoApplication) getApplication()).getDaoSession();<br>                        Student student = <span class="hljs-keyword">new</span> Student();<br>                        student.setStudentNo(i);<br>                        <span class="hljs-built_in">int</span> age = mRandom.nextInt(<span class="hljs-number">10</span>) + <span class="hljs-number">10</span>;<br>                        student.setAge(age);<br>                        student.setTelPhone(RandomValue.getTel());<br>                        <span class="hljs-built_in">String</span> chineseName = RandomValue.getChineseName();<br>                        student.setName(chineseName);<br>                        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>                            student.setSex(<span class="hljs-string">&quot;男&quot;</span>);<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            student.setSex(<span class="hljs-string">&quot;女&quot;</span>);<br>                        &#125;<br>                        student.setAddress(RandomValue.getRoad());<br>                        student.setGrade(<span class="hljs-built_in">String</span>.valueOf(age % <span class="hljs-number">10</span>) + <span class="hljs-string">&quot;年纪&quot;</span>);<br>                        student.setSchoolName(RandomValue.getSchoolName());<br>                        daoSession.insert(student);<br>                        <br>                        <span class="hljs-comment">//插入对应的CreditCard数据</span><br>                       <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> j = <span class="hljs-number">0</span>; j &lt; random.nextInt(<span class="hljs-number">5</span>) + <span class="hljs-number">1</span> ; j++) &#123;<br>                        CreditCard creditCard = <span class="hljs-keyword">new</span> CreditCard();<br>                        creditCard.setUserId(id);<br>                        creditCard.setUserName(userName);<br>                        creditCard.setCardNum(<span class="hljs-built_in">String</span>.valueOf(random.nextInt(<span class="hljs-number">899999999</span>) + <span class="hljs-number">100000000</span>) + <span class="hljs-built_in">String</span>.valueOf(random.nextInt(<span class="hljs-number">899999999</span>) + <span class="hljs-number">100000000</span>));<br>                        creditCard.setWhichBank(RandomValue.getBankName());<br>                        creditCard.setCardType(random.nextInt(<span class="hljs-number">10</span>));<br>                        daoSession.insert(creditCard);<br>                    &#125;<br>      &#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-多对多"><a href="#3-多对多" class="headerlink" title="3. 多对多"></a>3. 多对多</h2><p>一个学生有多个老师，老师有多个学生。<br> 做法：</p>
<ol>
<li><p>我们需要创建一个学生老师管理器(StudentAndTeacherBean)，用来对应学生和老师的ID;</p>
</li>
<li><p>我们需要在学生对象中，添加注解：</p>
<p>@ToMany<br> @JoinEntity(entity = StudentAndTeacherBean.class,sourceProperty = “studentId”,targetProperty = “teacherId”)<br> List<Teacher> teacherList;</p>
</li>
<li><p>我们需要在老师对象中，添加注解：@ToMany</p>
</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@JoinEntity</span>(entity = StudentAndTeacherBean.class,sourceProperty = <span class="hljs-string">&quot;teacherId&quot;</span>,targetProperty = <span class="hljs-string">&quot;studentId&quot;</span>)<br>  List&lt;Student&gt; studentList;<br></code></pre></td></tr></table></figure>

<p>StudentAndTeacherBean代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentAndTeacherBean</span> </span>&#123;<br>    <span class="hljs-meta">@Id(autoincrement = true)</span><br>    <span class="hljs-built_in">Long</span> id;<br>    <span class="hljs-built_in">Long</span> studentId;<span class="hljs-comment">//学生ID</span><br>    <span class="hljs-built_in">Long</span> teacherId;<span class="hljs-comment">//老师ID</span><br>    ……getter and setter ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Student 代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span>(autoincrement = <span class="hljs-keyword">true</span>)<br>    Long id;<br>    <span class="hljs-meta">@Unique</span><br>    <span class="hljs-built_in">int</span> studentNo;<span class="hljs-comment">//学号</span><br>    <span class="hljs-built_in">int</span> age; <span class="hljs-comment">//年龄</span><br>    <span class="hljs-built_in">String</span> telPhone;<span class="hljs-comment">//手机号</span><br>    <span class="hljs-built_in">String</span> sex; <span class="hljs-comment">//性别</span><br>    <span class="hljs-built_in">String</span> name;<span class="hljs-comment">//姓名</span><br>    <span class="hljs-built_in">String</span> address;<span class="hljs-comment">//家庭住址</span><br>    <span class="hljs-built_in">String</span> schoolName;<span class="hljs-comment">//学校名字</span><br>    <span class="hljs-built_in">String</span> grade;<span class="hljs-comment">//几年级</span><br>    <span class="hljs-meta">@ToMany</span><br>    <span class="hljs-meta">@JoinEntity</span>(entity = StudentAndTeacherBean.<span class="hljs-keyword">class</span>,sourceProperty = <span class="hljs-string">&quot;studentId&quot;</span>,targetProperty = <span class="hljs-string">&quot;teacherId&quot;</span>)<br>    <span class="hljs-built_in">List</span>&lt;Teacher&gt; teacherList;<br>        ……getter and setter ……<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>Teacher代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teacher</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span>(autoincrement = <span class="hljs-keyword">true</span>)<br>    Long id;<br>    <span class="hljs-meta">@Unique</span><br>    <span class="hljs-built_in">int</span> teacherNo;<span class="hljs-comment">//职工号</span><br>    <span class="hljs-built_in">int</span> age; <span class="hljs-comment">//年龄</span><br>    <span class="hljs-built_in">String</span> sex; <span class="hljs-comment">//性别</span><br>    <span class="hljs-built_in">String</span> telPhone;<br>    <span class="hljs-built_in">String</span> name;<span class="hljs-comment">//姓名</span><br>    <span class="hljs-built_in">String</span> schoolName;<span class="hljs-comment">//学校名字</span><br>    <span class="hljs-built_in">String</span> subject;<span class="hljs-comment">//科目</span><br><br>    <span class="hljs-meta">@ToMany</span><br>    <span class="hljs-meta">@JoinEntity</span>(entity = StudentAndTeacherBean.<span class="hljs-keyword">class</span>,sourceProperty = <span class="hljs-string">&quot;teacherId&quot;</span>,targetProperty = <span class="hljs-string">&quot;studentId&quot;</span>)<br>    <span class="hljs-built_in">List</span>&lt;Student&gt; studentList;<br>  ……getter and setter ……<br>&#125;<br></code></pre></td></tr></table></figure>

<p>数据添加：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addData</span>(<span class="hljs-params"></span>)</span>&#123;<br>                       Student student = <span class="hljs-keyword">new</span> Student();<br>                        student.setStudentNo(i);<br>                        <span class="hljs-built_in">int</span> age = mRandom.nextInt(<span class="hljs-number">10</span>) + <span class="hljs-number">10</span>;<br>                        student.setAge(age);<br>                        student.setTelPhone(RandomValue.getTel());<br>                        String chineseName = RandomValue.getChineseName();<br>                        student.setName(chineseName);<br>                        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) &#123;<br>                            student.setSex(<span class="hljs-string">&quot;男&quot;</span>);<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            student.setSex(<span class="hljs-string">&quot;女&quot;</span>);<br>                        &#125;<br>                        student.setAddress(RandomValue.getRoad());<br>                        student.setGrade(String.valueOf(age % <span class="hljs-number">10</span>) + <span class="hljs-string">&quot;年纪&quot;</span>);<br>                        student.setSchoolName(RandomValue.getSchoolName());<br>                        daoSession.insert(student);<br><br>                        Collections.shuffle(teacherList);<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> j = <span class="hljs-number">0</span>; j &lt; mRandom.nextInt(<span class="hljs-number">8</span>) + <span class="hljs-number">1</span>; j++) &#123;<br>                            <span class="hljs-keyword">if</span>(j &lt; teacherList.size())&#123;<br>                                Teacher teacher = teacherList.<span class="hljs-keyword">get</span>(j);<br>                                StudentAndTeacherBean teacherBean = <span class="hljs-keyword">new</span> StudentAndTeacherBean(student.getId(), teacher.getId());<br>                                daoSession.insert(teacherBean);<br>                            &#125;<br>                        &#125;<br>                        &#125;<br></code></pre></td></tr></table></figure>

<p>好了，成功;</p>
<h1 id="7-数据库的升级"><a href="#7-数据库的升级" class="headerlink" title="7.  数据库的升级"></a>7.  数据库的升级</h1><p>GreenDao的OpenHelper下有个 onUpgrade(Database db, int oldVersion, int newVersion)方法，当设置的数据库版本改变时，在数据库初始化的时候就会回调到这个方法，我们可以通过继承OpenHelper重写onUpgrade方法来实现数据库更新操作：</p>
<p>GreenDao的升级思路：</p>
<ol>
<li>创建临时表TMP_,复制原来的数据库到临时表中；</li>
<li>删除之前的原表；</li>
<li>创建新表；</li>
<li>将临时表中的数据复制到新表中，最后将TMP_表删除掉；</li>
</ol>
<p>ok,思路就是这样， 总共两个类： 一个MyDaoMaster(OpenHelper继承类)，一个MigrationHelper(数据库操作类) 下面是代码编写：</p>
<p>修改Application中的DaoMaster的创建：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">        MyDaoMaster helper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MyDaoMaster</span>(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;aserbaos.db&quot;</span>);<br><span class="hljs-comment">//      DaoMaster.DevOpenHelper helper = new DaoMaster.DevOpenHelper(this, &quot;aserbao.db&quot;);</span><br>        SQLiteDatabase db = helper.<span class="hljs-built_in">getWritableDatabase</span>();<br>        DaoMaster daoMaster = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DaoMaster</span>(db);<br>        daoSession = daoMaster.<span class="hljs-built_in">newSession</span>();<br></code></pre></td></tr></table></figure>

<p>MyDaoMaster代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDaoMaster</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OpenHelper</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">&quot;MyDaoMaster&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDaoMaster</span><span class="hljs-params">(Context context, String name)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(context, name);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDaoMaster</span><span class="hljs-params">(Context context, String name, SQLiteDatabase.CursorFactory factory)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(context, name, factory);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onUpgrade</span><span class="hljs-params">(Database db, <span class="hljs-keyword">int</span> oldVersion, <span class="hljs-keyword">int</span> newVersion)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>.onUpgrade(db, oldVersion, newVersion);<br>        MigrationHelper.migrate(db, <span class="hljs-keyword">new</span> MigrationHelper.ReCreateAllTableListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreateAllTables</span><span class="hljs-params">(Database db, <span class="hljs-keyword">boolean</span> ifNotExists)</span> </span>&#123;<br>                DaoMaster.createAllTables(db, ifNotExists);<br>            &#125;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDropAllTables</span><span class="hljs-params">(Database db, <span class="hljs-keyword">boolean</span> ifExists)</span> </span>&#123;<br>                DaoMaster.dropAllTables(db, ifExists);<br>            &#125;<br>        &#125;,ThingDao.class);<br>        Log.e(TAG, <span class="hljs-string">&quot;onUpgrade: &quot;</span> + oldVersion + <span class="hljs-string">&quot; newVersion = &quot;</span> + newVersion);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>MigrationHelper 代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br></pre></td><td class="code"><pre><code class="hljs tsx">public final class MigrationHelper &#123;<br><br>    public static boolean DEBUG = false;<br>    private static String TAG = &quot;MigrationHelper&quot;;<br>    private static final String SQLITE_MASTER = &quot;sqlite_master&quot;;<br>    private static final String SQLITE_TEMP_MASTER = &quot;sqlite_temp_master&quot;;<br><br>    private static WeakReference&lt;ReCreateAllTableListener&gt; weakListener;<br><br>    public interface ReCreateAllTableListener&#123;<br>        void onCreateAllTables(Database db, boolean ifNotExists);<br>        void onDropAllTables(Database db, boolean ifExists);<br>    &#125;<br><br>    public static void migrate(SQLiteDatabase db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        printLog(&quot;【The Old Database Version】&quot; + db.getVersion());<br>        Database database = new StandardDatabase(db);<br>        migrate(database, daoClasses);<br>    &#125;<br><br>    public static void migrate(SQLiteDatabase db, ReCreateAllTableListener listener, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        weakListener = new WeakReference&lt;&gt;(listener);<br>        migrate(db, daoClasses);<br>    &#125;<br><br>    public static void migrate(Database database, ReCreateAllTableListener listener, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        weakListener = new WeakReference&lt;&gt;(listener);<br>        migrate(database, daoClasses);<br>    &#125;<br><br>    public static void migrate(Database database, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        printLog(&quot;【Generate temp table】start&quot;);<br>        generateTempTables(database, daoClasses);<br>        printLog(&quot;【Generate temp table】complete&quot;);<br><br>        ReCreateAllTableListener listener = null;<br>        if (weakListener != null) &#123;<br>            listener = weakListener.get();<br>        &#125;<br><br>        if (listener != null) &#123;<br>            listener.onDropAllTables(database, true);<br>            printLog(&quot;【Drop all table by listener】&quot;);<br>            listener.onCreateAllTables(database, false);<br>            printLog(&quot;【Create all table by listener】&quot;);<br>        &#125; else &#123;<br>            dropAllTables(database, true, daoClasses);<br>            createAllTables(database, false, daoClasses);<br>        &#125;<br>        printLog(&quot;【Restore data】start&quot;);<br>        restoreData(database, daoClasses);<br>        printLog(&quot;【Restore data】complete&quot;);<br>    &#125;<br><br>    private static void generateTempTables(Database db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        for (int i = 0; i &lt; daoClasses.length; i++) &#123;<br>            String tempTableName = null;<br><br>            DaoConfig daoConfig = new DaoConfig(db, daoClasses[i]);<br>            String tableName = daoConfig.tablename;<br>            if (!isTableExists(db, false, tableName)) &#123;<br>                printLog(&quot;【New Table】&quot; + tableName);<br>                continue;<br>            &#125;<br>            try &#123;<br>                tempTableName = daoConfig.tablename.concat(&quot;_TEMP&quot;);<br>                StringBuilder dropTableStringBuilder = new StringBuilder();<br>                dropTableStringBuilder.append(&quot;DROP TABLE IF EXISTS &quot;).append(tempTableName).append(&quot;;&quot;);<br>                db.execSQL(dropTableStringBuilder.toString());<br><br>                StringBuilder insertTableStringBuilder = new StringBuilder();<br>                insertTableStringBuilder.append(&quot;CREATE TEMPORARY TABLE &quot;).append(tempTableName);<br>                insertTableStringBuilder.append(&quot; AS SELECT * FROM &quot;).append(tableName).append(&quot;;&quot;);<br>                db.execSQL(insertTableStringBuilder.toString());<br>                printLog(&quot;【Table】&quot; + tableName +&quot;\n ---Columns--&gt;&quot;+getColumnsStr(daoConfig));<br>                printLog(&quot;【Generate temp table】&quot; + tempTableName);<br>            &#125; catch (SQLException e) &#123;<br>                Log.e(TAG, &quot;【Failed to generate temp table】&quot; + tempTableName, e);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    private static boolean isTableExists(Database db, boolean isTemp, String tableName) &#123;<br>        if (db == null || TextUtils.isEmpty(tableName)) &#123;<br>            return false;<br>        &#125;<br>        String dbName = isTemp ? SQLITE_TEMP_MASTER : SQLITE_MASTER;<br>        String sql = &quot;SELECT COUNT(*) FROM &quot; + dbName + &quot; WHERE type = ? AND name = ?&quot;;<br>        Cursor cursor=null;<br>        int count = 0;<br>        try &#123;<br>            cursor = db.rawQuery(sql, new String[]&#123;&quot;table&quot;, tableName&#125;);<br>            if (cursor == null || !cursor.moveToFirst()) &#123;<br>                return false;<br>            &#125;<br>            count = cursor.getInt(0);<br>        &#125; catch (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; finally &#123;<br>            if (cursor != null)<br>                cursor.close();<br>        &#125;<br>        return count &gt; 0;<br>    &#125;<br><br><br>    private static String getColumnsStr(DaoConfig daoConfig) &#123;<br>        if (daoConfig == null) &#123;<br>            return &quot;no columns&quot;;<br>        &#125;<br>        StringBuilder builder = new StringBuilder();<br>        for (int i = 0; i &lt; daoConfig.allColumns.length; i++) &#123;<br>            builder.append(daoConfig.allColumns[i]);<br>            builder.append(&quot;,&quot;);<br>        &#125;<br>        if (builder.length() &gt; 0) &#123;<br>            builder.deleteCharAt(builder.length() - 1);<br>        &#125;<br>        return builder.toString();<br>    &#125;<br><br><br>    private static void dropAllTables(Database db, boolean ifExists, @NonNull Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        reflectMethod(db, &quot;dropTable&quot;, ifExists, daoClasses);<br>        printLog(&quot;【Drop all table by reflect】&quot;);<br>    &#125;<br><br>    private static void createAllTables(Database db, boolean ifNotExists, @NonNull Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        reflectMethod(db, &quot;createTable&quot;, ifNotExists, daoClasses);<br>        printLog(&quot;【Create all table by reflect】&quot;);<br>    &#125;<br><br>    /**<br>     * dao class already define the sql exec method, so just invoke it<br>     */<br>    private static void reflectMethod(Database db, String methodName, boolean isExists, @NonNull Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        if (daoClasses.length &lt; 1) &#123;<br>            return;<br>        &#125;<br>        try &#123;<br>            for (Class cls : daoClasses) &#123;<br>                Method method = cls.getDeclaredMethod(methodName, Database.class, boolean.class);<br>                method.invoke(null, db, isExists);<br>            &#125;<br>        &#125; catch (NoSuchMethodException e) &#123;<br>            e.printStackTrace();<br>        &#125; catch (InvocationTargetException e) &#123;<br>            e.printStackTrace();<br>        &#125; catch (IllegalAccessException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    private static void restoreData(Database db, Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt;... daoClasses) &#123;<br>        for (int i = 0; i &lt; daoClasses.length; i++) &#123;<br>            DaoConfig daoConfig = new DaoConfig(db, daoClasses[i]);<br>            String tableName = daoConfig.tablename;<br>            String tempTableName = daoConfig.tablename.concat(&quot;_TEMP&quot;);<br><br>            if (!isTableExists(db, true, tempTableName)) &#123;<br>                continue;<br>            &#125;<br><br>            try &#123;<br>                // get all columns from tempTable, take careful to use the columns list<br>                List&lt;TableInfo&gt; newTableInfos = TableInfo.getTableInfo(db, tableName);<br>                List&lt;TableInfo&gt; tempTableInfos = TableInfo.getTableInfo(db, tempTableName);<br>                ArrayList&lt;String&gt; selectColumns = new ArrayList&lt;&gt;(newTableInfos.size());<br>                ArrayList&lt;String&gt; intoColumns = new ArrayList&lt;&gt;(newTableInfos.size());<br>                for (TableInfo tableInfo : tempTableInfos) &#123;<br>                    if (newTableInfos.contains(tableInfo)) &#123;<br>                        String column = &#x27;`&#x27; + tableInfo.name + &#x27;`&#x27;;<br>                        intoColumns.add(column);<br>                        selectColumns.add(column);<br>                    &#125;<br>                &#125;<br>                // NOT NULL columns list<br>                for (TableInfo tableInfo : newTableInfos) &#123;<br>                    if (tableInfo.notnull &amp;&amp; !tempTableInfos.contains(tableInfo)) &#123;<br>                        String column = &#x27;`&#x27; + tableInfo.name + &#x27;`&#x27;;<br>                        intoColumns.add(column);<br><br>                        String value;<br>                        if (tableInfo.dfltValue != null) &#123;<br>                            value = &quot;&#x27;&quot; + tableInfo.dfltValue + &quot;&#x27; AS &quot;;<br>                        &#125; else &#123;<br>                            value = &quot;&#x27;&#x27; AS &quot;;<br>                        &#125;<br>                        selectColumns.add(value + column);<br>                    &#125;<br>                &#125;<br><br>                if (intoColumns.size() != 0) &#123;<br>                    StringBuilder insertTableStringBuilder = new StringBuilder();<br>                    insertTableStringBuilder.append(&quot;REPLACE INTO &quot;).append(tableName).append(&quot; (&quot;);<br>                    insertTableStringBuilder.append(TextUtils.join(&quot;,&quot;, intoColumns));<br>                    insertTableStringBuilder.append(&quot;) SELECT &quot;);<br>                    insertTableStringBuilder.append(TextUtils.join(&quot;,&quot;, selectColumns));<br>                    insertTableStringBuilder.append(&quot; FROM &quot;).append(tempTableName).append(&quot;;&quot;);<br>                    db.execSQL(insertTableStringBuilder.toString());<br>                    printLog(&quot;【Restore data】 to &quot; + tableName);<br>                &#125;<br>                StringBuilder dropTableStringBuilder = new StringBuilder();<br>                dropTableStringBuilder.append(&quot;DROP TABLE &quot;).append(tempTableName);<br>                db.execSQL(dropTableStringBuilder.toString());<br>                printLog(&quot;【Drop temp table】&quot; + tempTableName);<br>            &#125; catch (SQLException e) &#123;<br>                Log.e(TAG, &quot;【Failed to restore data from temp table 】&quot; + tempTableName, e);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    private static List&lt;String&gt; getColumns(Database db, String tableName) &#123;<br>        List&lt;String&gt; columns = null;<br>        Cursor cursor = null;<br>        try &#123;<br>            cursor = db.rawQuery(&quot;SELECT * FROM &quot; + tableName + &quot; limit 0&quot;, null);<br>            if (null != cursor &amp;&amp; cursor.getColumnCount() &gt; 0) &#123;<br>                columns = Arrays.asList(cursor.getColumnNames());<br>            &#125;<br>        &#125; catch (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; finally &#123;<br>            if (cursor != null)<br>                cursor.close();<br>            if (null == columns)<br>                columns = new ArrayList&lt;&gt;();<br>        &#125;<br>        return columns;<br>    &#125;<br><br>    private static void printLog(String info)&#123;<br>        if(DEBUG)&#123;<br>            Log.d(TAG, info);<br>        &#125;<br>    &#125;<br><br>    private static class TableInfo &#123;<br>        int cid;<br>        String name;<br>        String type;<br>        boolean notnull;<br>        String dfltValue;<br>        boolean pk;<br><br>        @Override<br>        public boolean equals(Object o) &#123;<br>            return this == o<br>                    || o != null<br>                    &amp;&amp; getClass() == o.getClass()<br>                    &amp;&amp; name.equals(((TableInfo) o).name);<br>        &#125;<br><br>        @Override<br>        public String toString() &#123;<br>            return &quot;TableInfo&#123;&quot; +<br>                    &quot;cid=&quot; + cid +<br>                    &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +<br>                    &quot;, type=&#x27;&quot; + type + &#x27;\&#x27;&#x27; +<br>                    &quot;, notnull=&quot; + notnull +<br>                    &quot;, dfltValue=&#x27;&quot; + dfltValue + &#x27;\&#x27;&#x27; +<br>                    &quot;, pk=&quot; + pk +<br>                    &#x27;&#125;&#x27;;<br>        &#125;<br><br>        private static List&lt;TableInfo&gt; getTableInfo(Database db, String tableName) &#123;<br>            String sql = &quot;PRAGMA table_info(&quot; + tableName + &quot;)&quot;;<br>            printLog(sql);<br>            Cursor cursor = db.rawQuery(sql, null);<br>            if (cursor == null)<br>                return new ArrayList&lt;&gt;();<br>            TableInfo tableInfo;<br>            List&lt;TableInfo&gt; tableInfos = new ArrayList&lt;&gt;();<br>            while (cursor.moveToNext()) &#123;<br>                tableInfo = new TableInfo();<br>                tableInfo.cid = cursor.getInt(0);<br>                tableInfo.name = cursor.getString(1);<br>                tableInfo.type = cursor.getString(2);<br>                tableInfo.notnull = cursor.getInt(3) == 1;<br>                tableInfo.dfltValue = cursor.getString(4);<br>                tableInfo.pk = cursor.getInt(5) == 1;<br>                tableInfos.add(tableInfo);<br>                // printLog(tableName + &quot;：&quot; + tableInfo);<br>            &#125;<br>            cursor.close();<br>            return tableInfos;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="8-GreenDao数据库加密"><a href="#8-GreenDao数据库加密" class="headerlink" title="8. GreenDao数据库加密"></a>8. GreenDao数据库加密</h1><p>开发中对于存储于数据库中的敏感数据，我们可以通过对数据库加密来进行保护。GreenDao可以通过SQLCipher来进行加密处理。下面我们简单讲解下加密过程：</p>
<p>步骤：</p>
<ol>
<li>导入加密库文件：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">implementation <span class="hljs-string">&#x27;net.zetetic:android-database-sqlcipher:3.5.6&#x27;</span><br></code></pre></td></tr></table></figure>

<ol>
<li>修改DaoSession的生成方式：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//       MyDaoMaster helper = new MyDaoMaster(this, &quot;aserbaos.db&quot;);  //数据库升级写法</span><br>        DaoMaster.DevOpenHelper helper = <span class="hljs-keyword">new</span> DaoMaster.<span class="hljs-built_in">DevOpenHelper</span>(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;aserbao.db&quot;</span>);<br>        <span class="hljs-comment">//SQLiteDatabase db = helper.getWritableDatabase(); //不加密的写法</span><br>        Database db = helper.<span class="hljs-built_in">getEncryptedWritableDb</span>(<span class="hljs-string">&quot;aserbao&quot;</span>); <span class="hljs-comment">//数据库加密密码为“aserbao&quot;的写法</span><br>        DaoMaster daoMaster = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DaoMaster</span>(db);<br>        daoSession = daoMaster.<span class="hljs-built_in">newSession</span>();<br></code></pre></td></tr></table></figure>

<h1 id="9-项目地址"><a href="#9-项目地址" class="headerlink" title="9. 项目地址"></a>9. 项目地址</h1><p>当前文章所有代码在AserbaosAndroid/app/src/main/java/com/aserbao/aserbaosandroid/functions/database/greenDao/relation目录下；（不过就我这脾气，可能在今后整理代码的过程中会修改！不过请放心，修改后会在github上进行说明的）</p>
<p><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://github.com/aserbao/AserbaosAndroid">AserbaosAndroid</a><br> aserbao的个人Android总结项目，希望这个项目能成为最全面的Android开发学习项目，这是个美好的愿景，项目中还有很多未涉及到的地方，有很多没有讲到的点，希望看到这个项目的朋友，如果你在开发中遇到什么问题，在这个项目中没有找到对应的解决办法，希望你能够提出来，给我留言或者在项目github地址提issues,我有时间就会更新项目没有涉及到的部分！项目会一直维护下去。当然，我希望是Aserbao’sAndroid 能为所有Android开发者提供到帮助！也期望更多Android开发者能参与进来，只要你熟悉Android某一块，都可以将你的代码pull上分支！</p>
<h1 id="10-总结"><a href="#10-总结" class="headerlink" title="10 总结"></a>10 总结</h1><p>这篇文章写到这里，零零碎碎花了差不多两周时间，从十月八号开始到今天正式准备发布，也算是对GreenDao数据库的进一步认识！如文章开头所说，我Android开发之初，使用的是自己编写SQLite来实现数据库存储，到后来使用第三方存储LitePal，最近，项目早期就使用了GreenDao，所以就又学习了一番GreenDao。对于开发者来说，我觉得无论是这三种中的哪一种，其实只要掌握一种我觉得就足够了！当然如果你有时间，可以多学习几种，多学无害嘛！最后，一如既往的说一下：如果你是Android开发者，你在开发路上遇到任何问题，欢迎来我的公众号给我留言，咱们一起讨论，加入Android开发讨论小组，一起进步！文章转载请注明出处。</p>
<h1 id="11-参考博客"><a href="#11-参考博客" class="headerlink" title="11. 参考博客"></a>11. 参考博客</h1><p><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2017/0703/8144.html">Android ORM 框架：GreenDao 使用详解</a><br> <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.cnblogs.com/whoislcj/p/5651396.html">Android数据存储之GreenDao 3.0 详解</a><br> <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://xujiaojie.github.io/2017/11/22/%E6%8B%86%E8%BD%AE%E5%AD%90%E7%B3%BB%E5%88%97%E4%B9%8BGreenDao%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">拆轮子系列之GreenDao框架原理分析</a></p>
<h1 id="12-修改记录"><a href="#12-修改记录" class="headerlink" title="12.修改记录"></a>12.修改记录</h1><ol>
<li>CreditCard中不能只使用一个useId来做关联，因为我这里Teacher和Student都和CreditCard是一对多关系，所以我们需要建两个对应关系字段。为了分辨添加了studentId和teacherId。</li>
</ol>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Entity</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreditCard</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span><br>    Long id;<br>    Long studentId;<br>    Long teacherId;<br>    <span class="hljs-built_in">String</span> userName;<span class="hljs-comment">//持有者名字</span><br>    <span class="hljs-built_in">String</span> cardNum;<span class="hljs-comment">//卡号</span><br>    <span class="hljs-built_in">String</span> whichBank;<span class="hljs-comment">//哪个银行的</span><br>    <span class="hljs-built_in">int</span> cardType;<span class="hljs-comment">//卡等级，分类 0 ~ 5</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li>Student中的@ToMany（referencedJoinProperty =“id”）这个id对应的是CreditCard中的studentId，不是自增Id。（问题由@<a target="_blank" rel="noopener" href="https://www.jianshu.com/u/c4d6deba2fb4">山豆几_</a>提出，感谢）<br> 修改后的代码应该是：</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@ToMany</span>(referencedJoinProperty = <span class="hljs-string">&quot;studentId&quot;</span>)<br>  List&lt;CreditCard&gt; creditCardsList;<br></code></pre></td></tr></table></figure>



<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/53083f782ea2">https://www.jianshu.com/p/53083f782ea2</a></p>

      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>MengLong Sun</li>
    <li><strong>本文链接：</strong><a href="http://www.jianzhioffer.com/study/GreenDao%E4%BD%BF%E7%94%A8%E8%A7%A3%E6%9E%90/index.html" title="http:&#x2F;&#x2F;www.jianzhioffer.com&#x2F;study&#x2F;GreenDao%E4%BD%BF%E7%94%A8%E8%A7%A3%E6%9E%90&#x2F;index.html">http:&#x2F;&#x2F;www.jianzhioffer.com&#x2F;study&#x2F;GreenDao%E4%BD%BF%E7%94%A8%E8%A7%A3%E6%9E%90&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
        
  <nav class="nav">
    <a href="/study/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/"><i class="iconfont iconleft"></i>Android App优化之性能分析工具</a>
    <a href="/study/APng%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA/">APng图片展示<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84"><span class="toc-text">1. 存储的数据库结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-GreenDao%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">2. GreenDao的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFGreenDao%EF%BC%9F"><span class="toc-text">什么是GreenDao？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GreenDao%E7%9A%84%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-text">GreenDao的官方文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GreenDao%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9F"><span class="toc-text">GreenDao的作用？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GreenDao%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%EF%BC%9F"><span class="toc-text">GreenDao的优缺点？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-GreenDao%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3. GreenDao的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AF%BC%E5%85%A5Gradle%E6%8F%92%E4%BB%B6%E5%92%8CDao%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-text">1. 导入Gradle插件和Dao代码生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">2. 创建存储对象实体类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-GreenDao%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">3. GreenDao初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8GreenDao%E5%AE%9E%E7%8E%B0%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-text">4. 使用GreenDao实现增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A2%9E"><span class="toc-text">1. 增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A0"><span class="toc-text">2. 删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%94%B9"><span class="toc-text">3. 改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9F%A5"><span class="toc-text">4. 查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-QueryBuilder%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">4. QueryBuilder的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8QueryBuilder%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-text">1. 使用QueryBuilder进行查询操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">1. 简单条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8E%9F%E5%A7%8B%E6%9F%A5%E8%AF%A2"><span class="toc-text">2. 原始查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B5%8C%E5%A5%97%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">3. 嵌套条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%E6%9F%A5%E6%89%BE"><span class="toc-text">4. 多次执行查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%9C%A8%E5%A4%9A%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%B8%AD%E4%BD%BF%E7%94%A8QueryBuilder"><span class="toc-text">5. 在多个线程中使用QueryBuilder</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8QueryBuilder%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="toc-text">2. 使用QueryBuilder进行批量删除操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%B3%A8%E8%A7%A3%E8%AE%B2%E8%A7%A3"><span class="toc-text">5. 注解讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Entity%E6%B3%A8%E8%A7%A3"><span class="toc-text">1. @Entity注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E5%B1%9E%E6%80%A7%E6%B3%A8%E8%A7%A3%EF%BC%88-Id%EF%BC%8C-Property%EF%BC%8C-NotNull%EF%BC%8C-Transient%EF%BC%89"><span class="toc-text">2.  基础属性注解（@Id，@Property，@NotNull，@Transient）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%B4%A2%E5%BC%95%E6%B3%A8%E8%A7%A3"><span class="toc-text">3. 索引注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%85%B3%E7%B3%BB%E6%B3%A8%E8%A7%A3"><span class="toc-text">4. 关系注解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E4%B8%80%E5%AF%B9%E4%B8%80%EF%BC%8C%E4%B8%80%E5%AF%B9%E5%A4%9A%EF%BC%8C%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-text">6. 一对一，一对多，多对多关系表的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%B8%80%E5%AF%B9%E4%B8%80"><span class="toc-text">1. 一对一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">2. 一对多</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="toc-text">3. 多对多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8D%87%E7%BA%A7"><span class="toc-text">7.  数据库的升级</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-GreenDao%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%A0%E5%AF%86"><span class="toc-text">8. GreenDao数据库加密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80"><span class="toc-text">9. 项目地址</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%80%BB%E7%BB%93"><span class="toc-text">10 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%8F%82%E8%80%83%E5%8D%9A%E5%AE%A2"><span class="toc-text">11. 参考博客</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95"><span class="toc-text">12.修改记录</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a><p><a target="_blank" href="https://beian.miit.gov.cn/">京ICP备20023327号-1</a></p></p></div>
  
</footer>
  
  
  
  
    <div class="search">
  <div class="search-container">
    <div class="search-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <div class="search-input-wrapper">
      <i class="search-input-icon iconfont iconsearch"></i>
      <input class="search-input" type="search" id="search-input" placeholder="Search..." autofocus autocomplete="off"
        autocorrect="off" autocapitalize="off">
    </div>
    <div class="search-output" id="search-output"></div>
  </div>
</div>
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>








<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>