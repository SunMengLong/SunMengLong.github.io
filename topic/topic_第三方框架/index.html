

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>第三方框架 - Android高级工程师</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="1.dagger2Dagger2是一个主要用于依赖注入...">
  <meta name="author" content="MengLong Sun">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: false,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: false,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
      
      
    </div>
    <div class="center">第三方框架</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 相册</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="https://t7.baidu.com/it/u=3165657288,4248157545&fm=193&f=GIF" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">第三方框架</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>July 23, 2021</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>9721</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h3 id="1-dagger2"><a href="#1-dagger2" class="headerlink" title="1.dagger2"></a>1.dagger2</h3><p>Dagger2是一个主要用于依赖注入的框架，减少初始化对象操作，降低耦合度</p>
<h3 id="2-Xutils-OKhttp-Volley-Retrofit对比（源码需要自己去看）"><a href="#2-Xutils-OKhttp-Volley-Retrofit对比（源码需要自己去看）" class="headerlink" title="2.Xutils, OKhttp, Volley, Retrofit对比（源码需要自己去看）"></a>2.Xutils, OKhttp, Volley, Retrofit对比（源码需要自己去看）</h3><p>Xutils这个框架非常全面，可以进行网络请求，可以进行图片加载处理，可以数据储存，还可以对view进行注解，使用这个框架非常方便，但是缺点也是非常明显的，使用这个项目，会导致项目对这个框架依赖非常的严重，一旦这个框架出现问题，那么对项目来说影响非常大的。</p>
<p>OKhttp：Android开发中是可以直接使用现成的api进行网络请求的。就是使用HttpClient,HttpUrlConnection进行操作。okhttp针对Java和Android程序，封装的一个高性能的http请求库，支持同步，异步，而且okhttp又封装了线程池，封装了数据转换，封装了参数的使用，错误处理等。API使用起来更加的方便。但是我们在项目中使用的时候仍然需要自己在做一层封装，这样才能使用的更加的顺手。</p>
<p>Volley：Volley是Google官方出的一套小而巧的异步请求库，该框架封装的扩展性很强，支持HttpClient、HttpUrlConnection， 甚至支持OkHttp，而且Volley里面也封装了ImageLoader，所以如果你愿意你甚至不需要使用图片加载框架，不过这块功能没有一些专门的图片加载框架强大，对于简单的需求可以使用，稍复杂点的需求还是需要用到专门的图片加载框架。Volley也有缺陷，比如不支持post大数据，所以不适合上传文件。不过Volley设计的初衷本身也就是为频繁的、数据量小的网络请求而生。</p>
<p>Retrofit：Retrofit是Square公司出品的默认基于OkHttp封装的一套RESTful网络请求框架，RESTful是目前流行的一套api设计的风格， 并不是标准。Retrofit的封装可以说是很强大，里面涉及到一堆的设计模式,可以通过注解直接配置请求，可以使用不同的http客户端，虽然默认是用http ，可以使用不同Json Converter 来序列化数据，同时提供对RxJava的支持，使用Retrofit + OkHttp + RxJava + Dagger2 可以说是目前比较潮的一套框架，但是需要有比较高的门槛。</p>
<p>Volley VS OkHttp<br>Volley的优势在于封装的更好，而使用OkHttp你需要有足够的能力再进行一次封装。而OkHttp的优势在于性能更高，因为 OkHttp基于NIO和Okio ，所以性能上要比 Volley更快。IO 和 NIO这两个都是Java中的概念，如果我从硬盘读取数据，第一种方式就是程序一直等，数据读完后才能继续操作这种是最简单的也叫阻塞式IO,还有一种是你读你的,程序接着往下执行，等数据处理完你再来通知我，然后再处理回调。而第二种就是 NIO 的方式，非阻塞式， 所以NIO当然要比IO的性能要好了,而 Okio是 Square 公司基于IO和NIO基础上做的一个更简单、高效处理数据流的一个库。理论上如果Volley和OkHttp对比的话，更倾向于使用 Volley，因为Volley内部同样支持使用OkHttp,这点OkHttp的性能优势就没了， 而且 Volley 本身封装的也更易用，扩展性更好些。</p>
<p>OkHttp VS Retrofit<br>毫无疑问，Retrofit 默认是基于 OkHttp 而做的封装，这点来说没有可比性，肯定首选 Retrofit。</p>
<p>Volley VS Retrofit<br>这两个库都做了不错的封装，但Retrofit解耦的更彻底,尤其Retrofit2.0出来，Jake对之前1.0设计不合理的地方做了大量重构， 职责更细分，而且Retrofit默认使用OkHttp,性能上也要比Volley占优势，再有如果你的项目如果采用了RxJava ，那更该使用 Retrofit 。所以这两个库相比，Retrofit更有优势，在能掌握两个框架的前提下该优先使用 Retrofit。但是Retrofit门槛要比Volley稍高些，要理解他的原理，各种用法，想彻底搞明白还是需要花些功夫的，如果你对它一知半解，那还是建议在商业项目使用Volley吧。</p>
<h3 id="3-Universal-ImageLoader，Picasso，Fresco，Glide对比-源码的话，得自己去看"><a href="#3-Universal-ImageLoader，Picasso，Fresco，Glide对比-源码的话，得自己去看" class="headerlink" title="3.Universal-ImageLoader，Picasso，Fresco，Glide对比( 源码的话，得自己去看)"></a>3.Universal-ImageLoader，Picasso，Fresco，Glide对比( 源码的话，得自己去看)</h3><p>Fresco </p>
<p> Facebook 推出的开源图片缓存工具，主要特点包括：两个内存缓存加上 Native 缓存构成了三级缓存，<br>优点：</p>
<p>图片存储在安卓系统的匿名共享内存, 而不是虚拟机的堆内存中, 图片的中间缓冲数据也存放在本地堆内存, 所以, 应用程序有更多的内存使用, 不会因为图片加载而导致oom, 同时也减少垃圾回收器频繁调用回收 Bitmap 导致的界面卡顿, 性能更高。<br>渐进式加载 JPEG 图片, 支持图片从模糊到清晰加载。<br>图片可以以任意的中心点显示在 ImageView, 而不仅仅是图片的中心。<br>JPEG 图片改变大小也是在 native 进行的, 不是在虚拟机的堆内存, 同样减少 OOM。<br>很好的支持 GIF 图片的显示。<br>缺点:<br>框架较大, 影响 Apk 体积<br>使用较繁琐<br>Universal-ImageLoader：</p>
<p>（估计由于HttpClient被Google放弃，作者就放弃维护这个框架）</p>
<p>优点：<br>1.支持下载进度监听<br>2.可以在 View 滚动中暂停图片加载，通过 PauseOnScrollListener 接口可以在 View 滚动中暂停图片加载。<br>3.默认实现多种内存缓存算法 这几个图片缓存都可以配置缓存算法，不过 ImageLoader 默认实现了较多缓存算法，如 Size 最大先删除、使用最少先删除、最近最少使用、先进先删除、时间最长先删除等。<br>4.支持本地缓存文件名规则定义</p>
<p>Picasso 优点</p>
<p>1.自带统计监控功能。支持图片缓存使用的监控，包括缓存命中率、已使用内存大小、节省的流量等。<br>2.支持优先级处理。每次任务调度前会选择优先级高的任务，比如 App 页面中 Banner 的优先级高于 Icon 时就很适用。<br>3.支持延迟到图片尺寸计算完成加载<br>4.支持飞行模式、并发线程数根据网络类型而变。 手机切换到飞行模式或网络类型变换时会自动调整线程池最大并发数，比如 wifi 最大并发为 4，4g 为 3，3g 为 2。 这里 Picasso 根据网络类型来决定最大并发数，而不是 CPU 核数。<br>5.“无”本地缓存。无”本地缓存，不是说没有本地缓存，而是 Picasso 自己没有实现，交给了 Square 的另外一个网络库 okhttp 去实现，这样的好处是可以通过请求 Response Header 中的 Cache-Control 及 Expired 控制图片的过期时间。</p>
<p>Glide 优点</p>
<p>不仅仅可以进行图片缓存还可以缓存媒体文件。Glide 不仅是一个图片缓存，它支持 Gif、WebP、缩略图。甚至是 Video，所以更该当做一个媒体缓存。<br>支持优先级处理。<br>与 Activity/Fragment 生命周期一致，支持 trimMemory。Glide 对每个 context 都保持一个 RequestManager，通过 FragmentTransaction 保持与 Activity/Fragment 生命周期一致，并且有对应的 trimMemory 接口实现可供调用。<br>支持 okhttp、Volley。Glide 默认通过 UrlConnection 获取数据，可以配合 okhttp 或是 Volley 使用。实际 ImageLoader、Picasso 也都支持 okhttp、Volley。<br>内存友好。Glide 的内存缓存有个 active 的设计，从内存缓存中取数据时，不像一般的实现用 get，而是用 remove，再将这个缓存数据放到一个 value 为软引用的 activeResources map 中，并计数引用数，在图片加载完成后进行判断，如果引用计数为空则回收掉。内存缓存更小图片，Glide 以 url、view_width、view_height、屏幕的分辨率等做为联合 key，将处理后的图片缓存在内存缓存中，而不是原始图片以节省大小与 Activity/Fragment 生命周期一致，支持 trimMemory。图片默认使用默认 RGB_565 而不是 ARGB_888，虽然清晰度差些，但图片更小，也可配置到 ARGB_888。<br>6.Glide 可以通过 signature 或不使用本地缓存支持 url 过期</p>
<h3 id="4-说说EventBus的原理"><a href="#4-说说EventBus的原理" class="headerlink" title="4.说说EventBus的原理"></a>4.说说EventBus的原理</h3><p>1、调用getDefault(),里面采用单利双重锁模式创建Eventbus对象</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> EventBus defaultInstance;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function">EventBus <span class="hljs-title">getDefault</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (defaultInstance == <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-keyword">synchronized</span> (EventBus.class) &#123;<br>					<span class="hljs-keyword">if</span> (defaultInstance == <span class="hljs-keyword">null</span>) &#123;<br>							defaultInstance = <span class="hljs-keyword">new</span> EventBus();<br>					&#125;<br>			&#125;<br>&#125;<br><span class="hljs-keyword">return</span> defaultInstance;<br></code></pre></td></tr></table></figure>



<p>2、构造方法 2.1,粘性事件,保存到ConCurrenHashMap集合,(在构造方法中实现), HashMap效率高,但线程不安全,在多线程的情况下,尽量用ConcurrentHashMap,避免多线程并发异常</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">EventBus(EventBusBuilder <span class="hljs-keyword">builder) </span>&#123;<br>      logger = <span class="hljs-keyword">builder.getLogger();</span><br><span class="hljs-keyword"></span>      <span class="hljs-keyword">subscriptionsByEventType </span>= new HashMap&lt;&gt;();<br>      typesBySubscriber = new HashMap&lt;&gt;();<br>      stickyEvents = new ConcurrentHashMap&lt;&gt;()<span class="hljs-comment">; //线程安全,</span><br>      mainThreadSupport = <span class="hljs-keyword">builder.getMainThreadSupport();</span><br><span class="hljs-keyword"></span>      mainThreadPoster = mainThreadSupport != null ? 					<br>      mainThreadSupport.createPoster(this) : null;<br>      <span class="hljs-keyword">backgroundPoster </span>= new <span class="hljs-keyword">BackgroundPoster(this);</span><br><span class="hljs-keyword"></span>      asyncPoster = new AsyncPoster(this);<br>      indexCount = <span class="hljs-keyword">builder.subscriberInfoIndexes </span>!= null ? <br>      <span class="hljs-keyword">builder.subscriberInfoIndexes.size() </span>: <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">subscriberMethodFinder </span>= new <br>      <span class="hljs-keyword">SubscriberMethodFinder(builder.subscriberInfoIndexes,</span><br><span class="hljs-keyword"></span>      <span class="hljs-keyword">builder.strictMethodVerification, </span><br>      <span class="hljs-keyword">builder.ignoreGeneratedIndex);</span><br><span class="hljs-keyword"></span>      logSubscriberExceptions = <span class="hljs-keyword">builder.logSubscriberExceptions;</span><br><span class="hljs-keyword"></span>      logNoSubscriberMessages = <span class="hljs-keyword">builder.logNoSubscriberMessages;</span><br><span class="hljs-keyword"></span>      sendSubscriberExceptionEvent = <br>      <span class="hljs-keyword">builder.sendSubscriberExceptionEvent;</span><br><span class="hljs-keyword"></span>      sendNoSubscriberEvent = <span class="hljs-keyword">builder.sendNoSubscriberEvent;</span><br><span class="hljs-keyword"></span>      throwSubscriberException = <span class="hljs-keyword">builder.throwSubscriberException;</span><br><span class="hljs-keyword"></span>      eventInheritance = <span class="hljs-keyword">builder.eventInheritance;</span><br><span class="hljs-keyword"></span>      executorService = <span class="hljs-keyword">builder.executorService;</span><br><span class="hljs-keyword"></span>&#125;<br></code></pre></td></tr></table></figure>



<p>3、注册register()方法主要做了3件事:</p>
<p>3.1,从缓存中获取订阅方法列表,</p>
<p>3.2,如果缓存中不存在则通过反射获取到订阅者所有的函数,</p>
<p>3.3,遍历再通过权限修饰符.参数长度(只允许一个参数).注解(@Subscribe)来判断是否是具备成为订阅函数的前提</p>
<p>3.4,具备则构建一个SubscriberMethod(订阅方法，其相当于一个数据实体类,包含方法,threadmode,参数类型,优先级,是否粘性事件这些参数),循环结束订阅函数列表构建完成添加进入缓存</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> subscriber</span>)</span> &#123;<br>		Class subscriberClass = subscriber.getClass();<br>		<span class="hljs-comment">//找到订阅者的方法.找出传进来的订阅者的所有订阅方法,然后遍历订阅者的方法.</span><br>		List subscriberMethods = 		<br>		subscriberMethodFinder.findSubscriberMethods(subscriberClass);<br>		synchronized (<span class="hljs-built_in">this</span>) &#123;<br>				<span class="hljs-keyword">for</span> (SubscriberMethod subscriberMethod : 	subscriberMethods) &#123;<br>				<span class="hljs-comment">//订阅者的注册</span><br>				subscribe(subscriber, subscriberMethod);<br>				&#125;<br>		&#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">findUsingReflectionInSingleClass</span>(<span class="hljs-params">FindState findState</span>)</span> &#123;<br>		Method[] methods;<br>		<span class="hljs-keyword">try</span> &#123;<br>				<span class="hljs-comment">// 通过反射来获取订阅者中所有的方法</span><br>				methods = findState.clazz.getDeclaredMethods();<br>		&#125; <span class="hljs-keyword">catch</span> (Throwable th) &#123;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>4、事件发送post()</p>
<p>4.1,post调用后先使用ThreadLocal来存储事件,他可以隔离多个线程对数据的访问冲突<br>4.2,根据事件类型(也就是Post参数的类型)为key从subscriptionsByEventType获取订阅方法和订阅者,这个容器不了解的可以看下注册的总结<br>此处我们已经具备了订阅者.订阅方法.待发送事件.post线程.threadmode等信息</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">post</span>(<span class="hljs-params">Object <span class="hljs-keyword">event</span></span>)</span> &#123;<br>		<span class="hljs-comment">//PostingThreadState 保存着事件队列和线程状态信息</span><br>		PostingThreadState postingState = currentPostingThreadState.<span class="hljs-keyword">get</span>();<br>		<span class="hljs-comment">//获取事假队列,并将当期事件插入事件队列</span><br>		List eventQueue = postingState.eventQueue;<br>		eventQueue.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">event</span>);<br><br>		<span class="hljs-keyword">if</span> (!postingState.isPosting) &#123;<br>    		postingState.isMainThread = isMainThread();<br>    		postingState.isPosting = <span class="hljs-literal">true</span>;<br>    		<span class="hljs-keyword">if</span> (postingState.canceled) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> EventBusException(<span class="hljs-string">&quot;Internal error. Abort state was not reset&quot;</span>);<br>    		&#125;<br>    		<span class="hljs-keyword">try</span> &#123;<br>     				<span class="hljs-comment">//处理队列中的所有事件,</span><br>    				<span class="hljs-comment">//将所有的事情交给postSingleEvent处理,并移除该事件</span><br>      			<span class="hljs-keyword">while</span> (!eventQueue.isEmpty()) &#123;<br>            		postSingleEvent(eventQueue.<span class="hljs-keyword">remove</span>(<span class="hljs-number">0</span>), postingState);<br>        		&#125;<br>    		&#125; <span class="hljs-keyword">finally</span> &#123;<br>        postingState.isPosting = <span class="hljs-literal">false</span>;<br>        postingState.isMainThread = <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>5、取消事件订阅</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> synchronized <span class="hljs-keyword">void</span> <span class="hljs-title">unregister</span>(<span class="hljs-params">Object subscriber</span>)</span> &#123;<br>		<span class="hljs-comment">//typesBySubscriber是一个map集合,</span><br>		<span class="hljs-comment">//通过subscriber找到 subscribedTypes (事件类型集合),</span><br>		List&gt; subscribedTypes = typesBySubscriber.<span class="hljs-keyword">get</span>(subscriber);<br>		<span class="hljs-keyword">if</span> (subscribedTypes != <span class="hljs-literal">null</span>) &#123;<br>				<span class="hljs-keyword">for</span> (Class eventType : subscribedTypes) &#123;<br>						unsubscribeByEventType(subscriber, eventType);<br>				&#125;<br>		&#125;<br>		<span class="hljs-comment">//将subscriber对应的eventType从typesBySubscriber移除</span><br>		typesBySubscriber.<span class="hljs-keyword">remove</span>(subscriber);<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="5-说说EventBus及使用方法"><a href="#5-说说EventBus及使用方法" class="headerlink" title="5.说说EventBus及使用方法"></a>5.说说EventBus及使用方法</h3><p>EvenetBus是一种发布-订阅事件总线.代码简洁,开销小,并很好的实现了发送者和接收者的解耦.</p>
<p>(是一种观察者模式)</p>
<p>使用：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">compile</span> ‘org.greenrobot:eventbus:<span class="hljs-number">3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>&#x27;<br></code></pre></td></tr></table></figure>

<p>传递数据：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageEvent</span> </span>&#123;<br>		<span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> message;<br>		<br>		<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">MessageEvent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>)</span>&#123;<br>				<span class="hljs-built_in">this</span>.message = message;<br>		&#125;<br>		<br>		<span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getMessage</span>(<span class="hljs-params"></span>)</span>&#123;<br>				<span class="hljs-keyword">return</span> message;<br>		&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//注册成为订阅者</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EventBus</span>.</span></span>get<span class="hljs-constructor">Default()</span>.register(this);<br></code></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//解除注册</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EventBus</span>.</span></span>get<span class="hljs-constructor">Default()</span>.unregister(this);<br></code></pre></td></tr></table></figure>

<p>在发送消息的地方</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EventBus</span>.</span></span>get<span class="hljs-constructor">Default()</span>.post(<span class="hljs-keyword">new</span> <span class="hljs-constructor">MessageEvent(<span class="hljs-string">&quot;从fragment将数据传递到activity22222222&quot;</span>)</span>);<br></code></pre></td></tr></table></figure>

<p>四个订阅方法：</p>
<p>onEvent:</p>
<p>如果使用onEvent作为订阅函数，那么该事件在哪个线程发布出来的，onEvent就会在这个线程中运行，也就是说发布事件和接收事件线程在同一个线程。使用这个方法时，在onEvent方法中不能执行耗时操作，如果执行耗时操作容易导致事件分发延迟。</p>
<p>onEventMainThread:</p>
<p>如果使用onEventMainThread作为订阅函数，那么不论事件是在哪个线程中发布出来的，onEventMainThread都会在UI线程中执行，接收事件就会在UI线程中运行，这个在Android中是非常有用的，因为在Android中只能在UI线程中跟新UI，所以在onEvnetMainThread方法中是不能执行耗时操作的。</p>
<p>onEventBackground:</p>
<p>如果使用onEventBackgrond作为订阅函数，那么如果事件是在UI线程中发布出来的，那么onEventBackground就会在子线程中运行，如果事件本来就是子线程中发布出来的，那么onEventBackground函数直接在该子线程中执行。</p>
<p>onEventAsync:</p>
<p>使用这个函数作为订阅函数，那么无论事件在哪个线程发布，都会创建新的子线程在执行onEventAsync。</p>
<p>3.0以前订阅者的订阅方法为onEvent()、onEventMainThread()、onEventBackgroundThread()和onEventAsync()。在Event Bus3.0之后统一采用注解@Subscribe的形式<br>@Subscribe(threadMode = ThreadMode.MAIN)<br>public void eventBusMain(String str){<br>Log.i(“TAG”, “MAIN:”+str+” Thread=“+Thread.currentThread().getId());</p>
<h3 id="6-用到的一些开源框架，介绍一个看过源码的，内部实现过程。"><a href="#6-用到的一些开源框架，介绍一个看过源码的，内部实现过程。" class="headerlink" title="6.用到的一些开源框架，介绍一个看过源码的，内部实现过程。"></a>6.用到的一些开源框架，介绍一个看过源码的，内部实现过程。</h3><p>这个自己准备几个网络请求的，图片加载的，异步任务的等等（最好手写出流程图）</p>
<h3 id="7-Glide图片加载"><a href="#7-Glide图片加载" class="headerlink" title="7.Glide图片加载"></a>7.Glide图片加载</h3><h5 id="Glide缓存策略"><a href="#Glide缓存策略" class="headerlink" title="Glide缓存策略:"></a>Glide缓存策略:</h5><p><img    class="lazyload" data-original="https://docimg10.docs.qq.com/image/AZ147Hzad5zteKwI7QYuXA?w=1010&h=610" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">img</span></p>
<h5 id="Glide缓存机制"><a href="#Glide缓存机制" class="headerlink" title="Glide缓存机制"></a>Glide缓存机制</h5><p>1、内存(活动缓存、内存缓存 )、磁盘缓存(资源类型，原始数据)</p>
<p>加载时依次顺序：活动缓存、内存缓存、资源缓存、磁盘缓存</p>
<p>活动缓存（界面展示时存入内存缓存，相当于创建一个Map集合，存在Map集合中，当界面销毁后，将活动缓存中的存入到内存缓存）</p>
<p>内存缓存(LruCache缓存：最近最少使用原则，当LinkedHashMap中容量大于最大容量时，移除最近不常使用的图片。sizeOf()计算图片大小，trim ToSize()计算当前LruCache容量是否超出MaxSize。如果是LruCache容量达到灵界点，自己移除的图片，则不需要加入到复用池中。。当活动缓存从内存缓存中获取图片时，内存缓存需要将该图片移除掉，这时候需要将该图片加入到复用池中。。（复用池也是用了LruCache原则，当复用池内存达到灵界点时，则将不常用的图片内存释放掉）)</p>
<p>Glide.with(Contex)主要是获取到一个RequestManager管理类，并创建一个空白的Fragment，将RequestManager管理类与Fragment进行绑定，进行生命周期的监听，RequestManager通过实现一个Lifecy接口，将Glide和fragment生命周期进行绑定。</p>

      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>MengLong Sun</li>
    <li><strong>本文链接：</strong><a href="http://www.jianzhioffer.com/topic/topic_%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/index.html" title="http:&#x2F;&#x2F;www.jianzhioffer.com&#x2F;topic&#x2F;topic_%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6&#x2F;index.html">http:&#x2F;&#x2F;www.jianzhioffer.com&#x2F;topic&#x2F;topic_%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
        
  <nav class="nav">
    <a href="/topic/topic_%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><i class="iconfont iconleft"></i>性能优化</a>
    <a href="/topic/topic_java%E5%9F%BA%E7%A1%80/">java基础<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-dagger2"><span class="toc-text">1.dagger2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Xutils-OKhttp-Volley-Retrofit%E5%AF%B9%E6%AF%94%EF%BC%88%E6%BA%90%E7%A0%81%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E5%8E%BB%E7%9C%8B%EF%BC%89"><span class="toc-text">2.Xutils, OKhttp, Volley, Retrofit对比（源码需要自己去看）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Universal-ImageLoader%EF%BC%8CPicasso%EF%BC%8CFresco%EF%BC%8CGlide%E5%AF%B9%E6%AF%94-%E6%BA%90%E7%A0%81%E7%9A%84%E8%AF%9D%EF%BC%8C%E5%BE%97%E8%87%AA%E5%B7%B1%E5%8E%BB%E7%9C%8B"><span class="toc-text">3.Universal-ImageLoader，Picasso，Fresco，Glide对比( 源码的话，得自己去看)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%AF%B4%E8%AF%B4EventBus%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">4.说说EventBus的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%AF%B4%E8%AF%B4EventBus%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">5.说说EventBus及使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%94%A8%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%AA%E7%9C%8B%E8%BF%87%E6%BA%90%E7%A0%81%E7%9A%84%EF%BC%8C%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E3%80%82"><span class="toc-text">6.用到的一些开源框架，介绍一个看过源码的，内部实现过程。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Glide%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD"><span class="toc-text">7.Glide图片加载</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  
</footer>
  
  
  
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>








<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>